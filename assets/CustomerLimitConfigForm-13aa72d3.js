import{ao as f,d as z,k as B,r as n,n as D,o as h,q as T,e as u,b as i,a as t,h as L,w as G,a0 as W,j as Z,ar as H,y as J,bX as $,W as ee,C as ae,B as le,v as te,_ as se,__tla as oe}from"./index-aaa5adb3.js";import{_ as re,__tla as de}from"./Dialog-9a73a39c.js";import{E as ue,__tla as ie}from"./el-tree-select-49584d8b.js";import{g as ne,__tla as ce}from"./index-d1d19999.js";import{d as V,h as me}from"./tree-02f455f9.js";import{a as pe,__tla as _e}from"./index-c1a6a53a.js";import{u as fe,__tla as ye}from"./useMessage-873da1e2.js";let g,c,O,S,k,ve=Promise.all([(()=>{try{return oe}catch{}})(),(()=>{try{return de}catch{}})(),(()=>{try{return ie}catch{}})(),(()=>{try{return ce}catch{}})(),(()=>{try{return _e}catch{}})(),(()=>{try{return ye}catch{}})()]).then(async()=>{c=(o=>(o[o.CUSTOMER_QUANTITY_LIMIT=1]="CUSTOMER_QUANTITY_LIMIT",o[o.CUSTOMER_LOCK_LIMIT=2]="CUSTOMER_LOCK_LIMIT",o))(c||{}),k=async o=>await f.get({url:"/crm/customer-limit-config/page",params:o}),S=async o=>await f.delete({url:"/crm/customer-limit-config/delete?id="+o}),g=se(z({__name:"CustomerLimitConfigForm",emits:["success"],setup(o,{expose:x,emit:R}){const{t:C}=B(),b=fe(),m=n(!1),U=n(""),p=n(!1),w=n(""),s=n({id:void 0,type:c.CUSTOMER_LOCK_LIMIT,userIds:void 0,deptIds:void 0,maxCount:void 0,dealCountEnabled:!1}),A=D({type:[{required:!0,message:"\u89C4\u5219\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],maxCount:[{required:!0,message:"\u6570\u91CF\u4E0A\u9650\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),y=n(),v=n(),I=n();x({open:async(a,e,l)=>{if(m.value=!0,U.value=C("action."+a),w.value=a,K(),l){p.value=!0;try{s.value=await(async d=>await f.get({url:"/crm/customer-limit-config/get?id="+d}))(l)}finally{p.value=!1}}else s.value.type=e;await Q(),await j()}});const N=R,Y=async()=>{if(y&&await y.value.validate()){p.value=!0;try{const a=s.value;w.value==="create"?(await(async e=>await f.post({url:"/crm/customer-limit-config/create",data:e}))(a),b.success(C("common.createSuccess"))):(await(async e=>await f.put({url:"/crm/customer-limit-config/update",data:e}))(a),b.success(C("common.updateSuccess"))),m.value=!1,N("success")}finally{p.value=!1}}},K=()=>{var a;s.value={id:void 0,type:c.CUSTOMER_LOCK_LIMIT,userIds:void 0,deptIds:void 0,maxCount:void 0,dealCountEnabled:!1},(a=y.value)==null||a.resetFields()},Q=async()=>{const a=await ne();v.value=[],v.value.push(...me(a))},j=async()=>{const a=await pe();I.value=[],I.value=H(t(v));const e={};a.forEach(l=>{l.dept&&(e[l.deptId]||(e[l.deptId]=[]),e[l.deptId].push(l))}),M(I.value,e)},M=(a,e)=>{for(let l=0;l<a.length;l++){if(a[l].isUser)continue;const d=e[a[l].id];d&&(a[l].children||(a[l].children=[]),a[l].children.push(...d.map(_=>({id:_.id,name:_.username+"-"+_.nickname,isUser:!0,disabled:_.status===1})))),a[l].children&&a[l].children.length!==0&&M(a[l].children,e),a[l].disabled=!0,a[l].id="null"}};return(a,e)=>{const l=ue,d=J,_=$,q=ee,F=ae,E=le,P=re,X=te;return h(),T(P,{title:t(U),modelValue:t(m),"onUpdate:modelValue":e[5]||(e[5]=r=>Z(m)?m.value=r:null)},{footer:u(()=>[i(E,{onClick:Y,type:"primary",disabled:t(p)},{default:u(()=>[L("\u786E \u5B9A")]),_:1},8,["disabled"]),i(E,{onClick:e[4]||(e[4]=r=>m.value=!1)},{default:u(()=>[L("\u53D6 \u6D88")]),_:1})]),default:u(()=>[G((h(),T(F,{ref_key:"formRef",ref:y,model:t(s),rules:t(A),"label-width":"200px"},{default:u(()=>[i(d,{label:"\u89C4\u5219\u9002\u7528\u4EBA\u7FA4",prop:"userIds"},{default:u(()=>[i(l,{modelValue:t(s).userIds,"onUpdate:modelValue":e[0]||(e[0]=r=>t(s).userIds=r),data:t(I),props:t(V),multiple:"",filterable:"","check-on-click-node":"","node-key":"id",placeholder:"\u8BF7\u9009\u62E9\u89C4\u5219\u9002\u7528\u4EBA\u7FA4"},null,8,["modelValue","data","props"])]),_:1}),i(d,{label:"\u89C4\u5219\u9002\u7528\u90E8\u95E8",prop:"deptIds"},{default:u(()=>[i(l,{modelValue:t(s).deptIds,"onUpdate:modelValue":e[1]||(e[1]=r=>t(s).deptIds=r),data:t(v),props:t(V),multiple:"",filterable:"","check-strictly":"","node-key":"id",placeholder:"\u8BF7\u9009\u62E9\u89C4\u5219\u9002\u7528\u90E8\u95E8"},null,8,["modelValue","data","props"])]),_:1}),i(d,{label:t(s).type===t(c).CUSTOMER_QUANTITY_LIMIT?"\u62E5\u6709\u5BA2\u6237\u6570\u4E0A\u9650":"\u9501\u5B9A\u5BA2\u6237\u6570\u4E0A\u9650",prop:"maxCount"},{default:u(()=>[i(_,{modelValue:t(s).maxCount,"onUpdate:modelValue":e[2]||(e[2]=r=>t(s).maxCount=r),placeholder:"\u8BF7\u8F93\u5165\u6570\u91CF\u4E0A\u9650"},null,8,["modelValue"])]),_:1},8,["label"]),t(s).type===t(c).CUSTOMER_QUANTITY_LIMIT?(h(),T(d,{key:0,label:"\u6210\u4EA4\u5BA2\u6237\u662F\u5426\u5360\u7528\u62E5\u6709\u5BA2\u6237\u6570",prop:"dealCountEnabled"},{default:u(()=>[i(q,{modelValue:t(s).dealCountEnabled,"onUpdate:modelValue":e[3]||(e[3]=r=>t(s).dealCountEnabled=r)},null,8,["modelValue"])]),_:1})):W("",!0)]),_:1},8,["model","rules"])),[[X,t(p)]])]),_:1},8,["title","modelValue"])}}}),[["__file","E:/newCode/GYZX-UI-ADMIN/src/views/crm/customer/limitConfig/CustomerLimitConfigForm.vue"]]),O=Object.freeze(Object.defineProperty({__proto__:null,default:g},Symbol.toStringTag,{value:"Module"}))});export{g as C,c as L,ve as __tla,O as a,S as d,k as g};
