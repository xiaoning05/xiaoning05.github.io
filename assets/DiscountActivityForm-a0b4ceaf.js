import{n as R,ao as v,d as J,k as K,r as c,o as U,c as Q,b as i,e as u,a as r,h as k,w as W,q as $,j as tt,F as et,ar as at,al as ot,B as st,bX as rt,E as lt,v as it,_ as ct,__tla as ut}from"./index-aaa5adb3.js";import{_ as nt,__tla as dt}from"./Dialog-9a73a39c.js";import{_ as pt,__tla as mt}from"./Form-93870143.js";import _t,{__tla as ft}from"./SpuSelect-80d29a4c.js";import yt,{__tla as vt}from"./SpuAndSkuList-1c8d773d.js";import{b as A,__tla as ht}from"./formatTime-9c0e8879.js";import{r as h,__tla as wt}from"./formRules-d4770b7e.js";import{D as bt,__tla as gt}from"./dict-f2796e71.js";import{u as Pt,__tla as kt}from"./useCrudSchemas-538534b3.js";import{b as St,__tla as Ct}from"./spu-d46eb782.js";import{g as Dt,__tla as It}from"./index-e75c9a63.js";import{u as Tt,__tla as Vt}from"./useMessage-873da1e2.js";let S,O,x,j,L,Ft=Promise.all([(()=>{try{return ut}catch{}})(),(()=>{try{return dt}catch{}})(),(()=>{try{return mt}catch{}})(),(()=>{try{return ft}catch{}})(),(()=>{try{return vt}catch{}})(),(()=>{try{return ht}catch{}})(),(()=>{try{return wt}catch{}})(),(()=>{try{return gt}catch{}})(),(()=>{try{return kt}catch{}})(),(()=>{try{return Ct}catch{}})(),(()=>{try{return It}catch{}})(),(()=>{try{return Vt}catch{}})()]).then(async()=>{let C,D,I;C=R({spuId:[h],name:[h],startTime:[h],endTime:[h],discountType:[h]}),D=R([{label:"\u6D3B\u52A8\u540D\u79F0",field:"name",isSearch:!0,form:{colProps:{span:24}},table:{width:120}},{label:"\u6D3B\u52A8\u5F00\u59CB\u65F6\u95F4",field:"startTime",formatter:A,isSearch:!0,search:{component:"DatePicker",componentProps:{valueFormat:"YYYY-MM-DD",type:"daterange"}},form:{component:"DatePicker",componentProps:{type:"date",valueFormat:"x"}},table:{width:120}},{label:"\u6D3B\u52A8\u7ED3\u675F\u65F6\u95F4",field:"endTime",formatter:A,isSearch:!0,search:{component:"DatePicker",componentProps:{valueFormat:"YYYY-MM-DD",type:"daterange"}},form:{component:"DatePicker",componentProps:{type:"date",valueFormat:"x"}},table:{width:120}},{label:"\u4F18\u60E0\u7C7B\u578B",field:"discountType",dictType:bt.PROMOTION_DISCOUNT_TYPE,dictClass:"number",isSearch:!0,form:{component:"Radio",value:1}},{label:"\u6D3B\u52A8\u5546\u54C1",field:"spuId",isTable:!0,isSearch:!1,form:{colProps:{span:24}},table:{width:300}},{label:"\u5907\u6CE8",field:"remark",isSearch:!1,form:{component:"Input",componentProps:{type:"textarea",rows:4},colProps:{span:24}},table:{width:300}}]),{allSchemas:I}=Pt(D),L=async m=>await v.get({url:"/promotion/discount-activity/page",params:m}),x=async m=>await v.put({url:"/promotion/discount-activity/close?id="+m}),j=async m=>await v.delete({url:"/promotion/discount-activity/delete?id="+m}),S=ct(J({name:"PromotionDiscountActivityForm",__name:"DiscountActivityForm",emits:["success"],setup(m,{expose:N,emit:X}){const{t:g}=K(),T=Tt(),_=c(!1),V=c(""),f=c(!1),F=c(""),n=c(),Y=c(),E=c(),q=[],w=c([]),P=c([]),z=(s,e)=>{n.value.setValues({spuId:s}),M(s,e)},M=async(s,e,a)=>{var b;const l=[],d=await St([s]);if(d.length==0)return;w.value=[];const t=d[0],y=e===void 0?t==null?void 0:t.skus:(b=t==null?void 0:t.skus)==null?void 0:b.filter(o=>e.includes(o.id));y==null||y.forEach(o=>{let p={skuId:o.id,spuId:t.id,discountType:1,discountPercent:0,discountPrice:0};a!==void 0&&(p=a.find(H=>H.skuId===o.id)||p),o.productConfig=p}),t.skus=y,l.push({spuId:t.id,spuDetail:t,propertyList:Dt(t)}),w.value.push(t),P.value=l};N({open:async(s,e)=>{var a;if(_.value=!0,V.value=g("action."+s),F.value=s,await Z(),e){f.value=!0;try{const l=await(async t=>await v.get({url:"/promotion/discount-activity/get?id="+t}))(e),d=l.products[0].spuId;await M(d,(a=l.products)==null?void 0:a.map(t=>t.skuId),l.products),n.value.setValues(l)}finally{f.value=!1}}}});const B=X,G=async()=>{if(n&&await n.value.getElFormRef().validate()){f.value=!0;try{const s=n.value.formModel,e=at(E.value.getSkuConfigs("productConfig"));e.forEach(a=>{a.discountType=s.discountType}),s.products=e,F.value==="create"?(await(async a=>await v.post({url:"/promotion/discount-activity/create",data:a}))(s),T.success(g("common.createSuccess"))):(await(async a=>await v.put({url:"/promotion/discount-activity/update",data:a}))(s),T.success(g("common.updateSuccess"))),_.value=!1,B("success")}finally{f.value=!1}}},Z=async()=>{w.value=[],P.value=[],await ot(),n.value.getElFormRef().resetFields()};return(s,e)=>{const a=st,l=rt,d=lt,t=pt,y=nt,b=it;return U(),Q(et,null,[i(y,{modelValue:r(_),"onUpdate:modelValue":e[2]||(e[2]=o=>tt(_)?_.value=o:null),title:r(V),width:"65%"},{footer:u(()=>[i(a,{disabled:r(f),type:"primary",onClick:G},{default:u(()=>[k("\u786E \u5B9A")]),_:1},8,["disabled"]),i(a,{onClick:e[1]||(e[1]=o=>_.value=!1)},{default:u(()=>[k("\u53D6 \u6D88")]),_:1})]),default:u(()=>[W((U(),$(t,{ref_key:"formRef",ref:n,isCol:!0,rules:r(C),schema:r(I).formSchema},{spuId:u(()=>[i(a,{onClick:e[0]||(e[0]=o=>r(Y).open())},{default:u(()=>[k("\u9009\u62E9\u5546\u54C1")]),_:1}),i(r(yt),{ref_key:"spuAndSkuListRef",ref:E,"rule-config":q,"spu-list":r(w),"spu-property-list-p":r(P)},{default:u(()=>[i(d,{align:"center",label:"\u4F18\u60E0\u91D1\u989D","min-width":"168"},{default:u(({row:o})=>[i(l,{modelValue:o.productConfig.discountPrice,"onUpdate:modelValue":p=>o.productConfig.discountPrice=p,min:0,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(d,{align:"center",label:"\u6298\u6263\u767E\u5206\u6BD4(%)","min-width":"168"},{default:u(({row:o})=>[i(l,{modelValue:o.productConfig.discountPercent,"onUpdate:modelValue":p=>o.productConfig.discountPercent=p,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["spu-list","spu-property-list-p"])]),_:1},8,["rules","schema"])),[[b,r(f)]])]),_:1},8,["modelValue","title"]),i(r(_t),{ref_key:"spuSelectRef",ref:Y,isSelectSku:!0,onConfirm:z},null,512)],64)}}}),[["__file","E:/newCode/GYZX-UI-ADMIN/src/views/mall/promotion/discountActivity/DiscountActivityForm.vue"]]),O=Object.freeze(Object.defineProperty({__proto__:null,default:S},Symbol.toStringTag,{value:"Module"}))});export{S as D,Ft as __tla,O as a,x as c,j as d,L as g};
