import{aq as x,d as J,K,u as M,r as T,e as U,a2 as R,a as l,aT as X,x as Y,a4 as Z,o as p,c as y,f as n,w as c,g as j,h as w,F as P,q as B,v as H,t as Q,aS as C,m as W,n as $,ae as ee,b_ as se,A as ae,D as te,G as oe,_ as re,__tla as le}from"./index-f0743f71.js";import ne,{__tla as ce}from"./LoginFormTitle-b0f23255.js";import{u as ie,L as D,__tla as ue}from"./useLogin-af1b323d.js";let V,pe=Promise.all([(()=>{try{return le}catch{}})(),(()=>{try{return ce}catch{}})(),(()=>{try{return ue}catch{}})()]).then(async()=>{let k,q,O;k={class:"form-cont"},q={key:0},O={key:1},V=re(J({name:"SSOLogin",__name:"SSOLogin",setup(de){const i=K(),{currentRoute:z}=M(),{getLoginState:A,setLoginState:G}=ie(),L=T({name:"",logo:""}),s=U({responseType:"",clientId:"",redirectUri:"",state:"",scopes:[]}),N=R(()=>l(A)===D.SSO),u=U({scopes:[]}),d=T(!1),E=async()=>{if(i.query.client_id===void 0)return;if(s.responseType=i.query.response_type,s.clientId=i.query.client_id,s.redirectUri=i.query.redirect_uri,s.state=i.query.state,i.query.scope&&(s.scopes=i.query.scope.split(" ")),s.scopes.length>0){const e=await I(!0,s.scopes,[]);if(e)return void(location.href=e)}const t=await(a=s.clientId,x.get({url:"/system/oauth2/authorize?clientId="+a}));var a;let o;if(L.value=t.client,s.scopes.length>0){o=[];for(const e of t.scopes)s.scopes.indexOf(e.key)>=0&&o.push(e)}else{o=t.scopes;for(const e of o)s.scopes.push(e.key)}for(const e of o)e.value&&u.scopes.push(e.key)},b=async t=>{let a,o;t?(a=u.scopes,o=s.scopes.filter(e=>a.indexOf(e)===-1)):(a=[],o=s.scopes),d.value=!0;try{const e=await I(!1,a,o);if(!e)return;location.href=e}finally{d.value=!1}},I=(t,a,o)=>((e,m,h,f,_,g,r)=>{const v={};for(const S of g)v[S]=!0;for(const S of r)v[S]=!1;return x.post({url:"/system/oauth2/authorize",headers:{"Content-type":"application/x-www-form-urlencoded"},params:{response_type:e,client_id:m,redirect_uri:h,state:f,auto_approve:_,scope:JSON.stringify(v)}})})(s.responseType,s.clientId,s.redirectUri,s.state,t,a,o),F=t=>{switch(t){case"user.read":return"\u8BBF\u95EE\u4F60\u7684\u4E2A\u4EBA\u4FE1\u606F";case"user.write":return"\u4FEE\u6539\u4F60\u7684\u4E2A\u4EBA\u4FE1\u606F";default:return t}};return X(()=>z.value,t=>{t.name==="SSOLogin"&&(G(D.SSO),E())},{immediate:!0}),(t,a)=>{const o=W,e=$,m=ee,h=se,f=ae,_=te,g=oe;return Y((p(),y("div",k,[n(ne,{style:{width:"100%"}}),n(e,{class:"form",style:{float:"none"},value:"uname"},{default:c(()=>[n(o,{label:l(L).name,name:"uname"},null,8,["label"])]),_:1}),j("div",null,[n(g,{model:l(u),class:"login-form"},{default:c(()=>[w(" \u6B64\u7B2C\u4E09\u65B9\u5E94\u7528\u8BF7\u6C42\u83B7\u5F97\u4EE5\u4E0B\u6743\u9650\uFF1A "),n(f,{prop:"scopes"},{default:c(()=>[n(h,{modelValue:l(u).scopes,"onUpdate:modelValue":a[0]||(a[0]=r=>l(u).scopes=r)},{default:c(()=>[(p(!0),y(P,null,B(l(s).scopes,r=>(p(),H(m,{key:r,label:r,style:{display:"block","margin-bottom":"-10px"}},{default:c(()=>[w(Q(F(r)),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(f,{class:"w-1/1"},{default:c(()=>[n(_,{loading:l(d),class:"w-6/10",type:"primary",onClick:a[1]||(a[1]=C(r=>b(!0),["prevent"]))},{default:c(()=>[l(d)?(p(),y("span",O,"\u6388 \u6743 \u4E2D...")):(p(),y("span",q,"\u540C\u610F\u6388\u6743"))]),_:1},8,["loading"]),n(_,{class:"w-3/10",onClick:a[2]||(a[2]=C(r=>b(!1),["prevent"]))},{default:c(()=>[w("\u62D2\u7EDD")]),_:1})]),_:1})]),_:1},8,["model"])])],512)),[[Z,l(N)]])}}}),[["__file","E:/newCode/GYZX-UI-ADMIN/src/views/Login/components/SSOLogin.vue"]])});export{pe as __tla,V as default};
