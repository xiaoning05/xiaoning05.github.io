import{ap as g,d as ne,p as pe,i as me,r as v,e as P,X as ce,o as i,v as c,w as l,f as t,a,h as n,x as fe,c as S,F as I,q as D,t as T,a4 as E,g as M,l as ve,am as ye,P as _e,A as he,B as Ve,ah as be,ai as ge,C as Te,j as we,ad as ke,bX as xe,k as Ue,y as Pe,z as Se,D as Ie,I as De,__tla as Ee}from"./index-d5b00dc9.js";import{_ as Ce,__tla as Ae}from"./Dialog.vue_vue_type_style_index_0_lang-03cf6454.js";import{i as Oe,__tla as Re}from"./spu-b7f32e1c.js";import{a as X,D as j,__tla as qe}from"./dict-29b94c3f.js";import{i as G,h as C}from"./constants-99751ef9.js";import{u as Fe,__tla as Ne}from"./useMessage-2288a5f2.js";let H,Y,$,Le=Promise.all([(()=>{try{return Ee}catch{}})(),(()=>{try{return Ae}catch{}})(),(()=>{try{return Re}catch{}})(),(()=>{try{return qe}catch{}})(),(()=>{try{return Ne}catch{}})()]).then(async()=>{let A,O;$=async w=>await g.get({url:"/promotion/reward-activity/page",params:w}),Y=async w=>await g.delete({url:"/promotion/reward-activity/delete?id="+w}),A={style:{float:"left"}},O={style:{float:"right","font-size":"13px",color:"#8492a6"}},H=ne({name:"ProductBrandForm",__name:"RewardForm",emits:["success"],setup(w,{expose:J,emit:K}){pe(()=>{Oe().then(r=>{q.value=r})});const{t:V}=me(),R=Fe(),q=v([]),y=v(!1),F=v(""),_=v(!1),N=v(""),d=v({id:void 0,name:void 0,startAndEndTime:void 0,startTime:void 0,endTime:void 0,conditionType:G.PRICE.type,remark:void 0,productScope:C.ALL.scope,productSpuIds:void 0,rules:[{limit:void 0,discountPrice:void 0,freeDelivery:void 0,point:void 0,couponIds:[],couponCounts:[]}]}),s=P([]),Q=P({name:[{required:!0,message:"\u6D3B\u52A8\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],startAndEndTime:[{required:!0,message:"\u6D3B\u52A8\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],conditionType:[{required:!0,message:"\u6761\u4EF6\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],productScope:[{required:!0,message:"\u5546\u54C1\u8303\u56F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],productSpuIds:[{required:!0,message:"\u5546\u54C1\u8303\u56F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),k=v([]);J({open:async(r,o)=>{if(y.value=!0,F.value=V("action."+r),N.value=r,le(),o){_.value=!0;try{let p=await(async u=>await g.get({url:"/promotion/reward-activity/get?id="+u}))(o);p.startAndEndTime=[new Date(p.startTime),new Date(p.endTime)],s.splice(0,s.length),p.rules.forEach(u=>{let h=P([]);u.freeDelivery&&h.push("\u5305\u90AE"),u.point&&h.push("\u9001\u79EF\u5206"),u.discountPrice&&h.push("\u8BA2\u5355\u91D1\u989D\u4F18\u60E0"),s.push(h)}),d.value=p}finally{_.value=!1}}}});const W=K,Z=async()=>{if(k&&await k.value.validate()){d.value.startTime=+new Date(d.value.startAndEndTime[0]),d.value.endTime=+new Date(d.value.startAndEndTime[1]),s.forEach((r,o)=>{d.value.rules[o].freeDelivery=!!r.includes("\u5305\u90AE"),r.includes("\u9001\u79EF\u5206")||(d.value.rules[o].point=void 0),r.includes("\u8BA2\u5355\u91D1\u989D\u4F18\u60E0")||(d.value.rules[o].discountPrice=void 0)}),_.value=!0;try{const r=d.value;N.value==="create"?(await(async o=>await g.post({url:"/promotion/reward-activity/create",data:o}))(r),R.success(V("common.createSuccess"))):(await(async o=>await g.put({url:"/promotion/reward-activity/update",data:o}))(r),R.success(V("common.updateSuccess"))),y.value=!1,W("success")}finally{_.value=!1}}},ee=()=>{d.value.rules.push({limit:void 0,discountPrice:void 0,freeDelivery:void 0,point:void 0,couponIds:[],couponCounts:[]}),s.push([])},le=()=>{d.value={id:void 0,name:void 0,startAndEndTime:void 0,startTime:void 0,endTime:void 0,conditionType:G.PRICE.type,remark:void 0,productScope:C.ALL.scope,productSpuIds:void 0,rules:[{limit:void 0,discountPrice:void 0,freeDelivery:void 0,point:void 0,couponIds:[],couponCounts:[]}]},s.splice(0,s.length),s.push(P([])),ye(()=>{var r;(r=k.value)==null||r.resetFields()})};return(r,o)=>{const p=_e,u=he,h=Ve,L=be,z=ge,x=Te,b=we,U=ke,ae=xe,te=ce("e-form"),de=Ue,oe=Pe,ue=Se,re=Ie,ie=Ce,se=De;return i(),c(ie,{title:a(F),modelValue:a(y),"onUpdate:modelValue":o[7]||(o[7]=e=>ve(y)?y.value=e:null)},{footer:l(()=>[t(x,{onClick:Z,type:"primary",disabled:a(_)},{default:l(()=>[n("\u786E \u5B9A")]),_:1},8,["disabled"]),t(x,{onClick:o[6]||(o[6]=e=>y.value=!1)},{default:l(()=>[n("\u53D6 \u6D88")]),_:1})]),default:l(()=>[fe((i(),c(re,{ref_key:"formRef",ref:k,model:a(d),rules:a(Q),"label-width":"80px"},{default:l(()=>[t(u,{label:"\u6D3B\u52A8\u540D\u79F0",prop:"name"},{default:l(()=>[t(p,{modelValue:a(d).name,"onUpdate:modelValue":o[0]||(o[0]=e=>a(d).name=e),placeholder:"\u8BF7\u8F93\u5165\u6D3B\u52A8\u540D\u79F0"},null,8,["modelValue"])]),_:1}),t(u,{label:"\u6D3B\u52A8\u65F6\u95F4",prop:"startAndEndTime"},{default:l(()=>[t(h,{modelValue:a(d).startAndEndTime,"onUpdate:modelValue":o[1]||(o[1]=e=>a(d).startAndEndTime=e),type:"datetimerange","range-separator":"-","start-placeholder":a(V)("common.startTimeText"),"end-placeholder":a(V)("common.endTimeText")},null,8,["modelValue","start-placeholder","end-placeholder"])]),_:1}),t(u,{label:"\u6761\u4EF6\u7C7B\u578B",prop:"conditionType"},{default:l(()=>[t(z,{modelValue:a(d).conditionType,"onUpdate:modelValue":o[2]||(o[2]=e=>a(d).conditionType=e)},{default:l(()=>[(i(!0),S(I,null,D(a(X)(a(j).PROMOTION_CONDITION_TYPE),e=>(i(),c(L,{key:e.value,label:e.value},{default:l(()=>[n(T(e.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"\u4F18\u60E0\u8BBE\u7F6E"},{default:l(()=>[(i(!0),S(I,null,D(a(d).rules,(e,f)=>(i(),c(de,{key:f,type:"flex"},{default:l(()=>[t(b,{span:24,style:{"font-weight":"bold",display:"flex"}},{default:l(()=>[n(" \u6D3B\u52A8\u5C42\u7EA7"+T(f+1)+" ",1),f!=0?(i(),c(x,{key:0,link:"",type:"danger",style:{"margin-left":"auto"},onClick:m=>(B=>{d.value.rules.splice(B,1),s.splice(B,1)})(f)},{default:l(()=>[n(" \u5220\u9664 ")]),_:2},1032,["onClick"])):E("",!0)]),_:2},1024),t(te,{ref_for:!0,ref:"formRef"+f,model:e},{default:l(()=>[t(u,{label:"\u4F18\u60E0\u95E8\u69DB:",prop:"limit","label-width":"100px",style:{"padding-left":"50px"}},{default:l(()=>[n(" \u6EE1 "),t(p,{style:{width:"150px",padding:"0 10px"},modelValue:e.limit,"onUpdate:modelValue":m=>e.limit=m,type:"number",placeholder:""},null,8,["modelValue","onUpdate:modelValue"]),n(" \u5143 ")]),_:2},1024),t(u,{label:"\u4F18\u60E0\u5185\u5BB9:","label-width":"100px",style:{"padding-left":"50px"}},{default:l(()=>[t(ae,{modelValue:a(s)[f],"onUpdate:modelValue":m=>a(s)[f]=m,style:{width:"100%"}},{default:l(()=>[t(b,{span:24},{default:l(()=>[t(U,{label:"\u8BA2\u5355\u91D1\u989D\u4F18\u60E0",name:"type"}),a(s)[f].includes("\u8BA2\u5355\u91D1\u989D\u4F18\u60E0")?(i(),c(u,{key:0},{default:l(()=>[n(" \u51CF "),t(p,{style:{width:"150px",padding:"0 20px"},modelValue:e.discountPrice,"onUpdate:modelValue":m=>e.discountPrice=m,type:"number",placeholder:""},null,8,["modelValue","onUpdate:modelValue"]),n(" \u5143 ")]),_:2},1024)):E("",!0)]),_:2},1024),t(b,{span:24},{default:l(()=>[t(U,{modelValue:e.freeDelivery,"onUpdate:modelValue":m=>e.freeDelivery=m,label:"\u5305\u90AE",name:"type"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(b,{span:24},{default:l(()=>[t(U,{label:"\u9001\u79EF\u5206",name:"type"}),a(s)[f].includes("\u9001\u79EF\u5206")?(i(),c(u,{key:0},{default:l(()=>[n(" \u9001 "),t(p,{style:{width:"150px",padding:"0 20px"},modelValue:e.point,"onUpdate:modelValue":m=>e.point=m,type:"number",placeholder:""},null,8,["modelValue","onUpdate:modelValue"]),n(" \u79EF\u5206 ")]),_:2},1024)):E("",!0)]),_:2},1024),t(b,{span:24},{default:l(()=>[t(U,{label:"\u9001\u4F18\u60E0\u5238",name:"type"})]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["model"])]),_:2},1024))),128)),t(x,{type:"primary",onClick:ee},{default:l(()=>[n("\u6DFB\u52A0\u6D3B\u52A8\u5C42\u7EA7")]),_:1})]),_:1}),t(u,{label:"\u6D3B\u52A8\u5546\u54C1",prop:"productScope"},{default:l(()=>[t(z,{modelValue:a(d).productScope,"onUpdate:modelValue":o[3]||(o[3]=e=>a(d).productScope=e)},{default:l(()=>[(i(!0),S(I,null,D(a(X)(a(j).PROMOTION_PRODUCT_SCOPE),e=>(i(),c(L,{key:e.value,label:e.value},{default:l(()=>[n(T(e.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d).productScope===a(C).SPU.scope?(i(),c(u,{key:0,prop:"productSpuIds"},{default:l(()=>[t(ue,{modelValue:a(d).productSpuIds,"onUpdate:modelValue":o[4]||(o[4]=e=>a(d).productSpuIds=e),placeholder:"\u8BF7\u9009\u62E9\u6D3B\u52A8\u5546\u54C1",clearable:"",size:"small",multiple:"",filterable:"",style:{width:"400px"}},{default:l(()=>[(i(!0),S(I,null,D(a(q),e=>(i(),c(oe,{key:e.id,label:e.name,value:e.id},{default:l(()=>[M("span",A,T(e.name),1),M("span",O," \uFFE5"+T((e.price/100).toFixed(2)),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):E("",!0),t(u,{label:"\u5907\u6CE8",prop:"remark"},{default:l(()=>[t(p,{modelValue:a(d).remark,"onUpdate:modelValue":o[5]||(o[5]=e=>a(d).remark=e),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[se,a(_)]])]),_:1},8,["title","modelValue"])}}})});export{H as _,Le as __tla,Y as d,$ as g};
