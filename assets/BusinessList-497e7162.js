import{d as F,r as _,e as G,u as H,aT as J,L as X,o as u,c as Y,f as t,w as l,h as m,a as e,x as g,v as p,a5 as v,t as Z,F as W,C as $,D as K,k as Q,H as V,I as tt,J as at,_ as et,__tla as rt}from"./index-f0743f71.js";import{_ as st,__tla as ot}from"./ContentWrap-5acc4fb9.js";import{_ as lt,__tla as ct}from"./index-cf7b3541.js";import{E as it,__tla as _t}from"./el-link-17c2244d.js";import{a as nt,b as ut,__tla as mt}from"./index-109e656c.js";import{c as pt,d as dt,__tla as ft}from"./index-8255f94a.js";import yt,{__tla as bt}from"./BusinessForm-19d1cb16.js";import{B as T,__tla as ht}from"./index-123b98f8.js";import{f as It,__tla as gt}from"./formatter-d3f1795f.js";import vt,{__tla as kt}from"./BusinessListModal-1aa20196.js";import{u as wt,__tla as Ct}from"./useMessage-75a00a06.js";import{__tla as zt}from"./index-a48a5540.js";import{__tla as Nt}from"./index-8beae3df.js";import{__tla as Rt}from"./Dialog-8f786edd.js";import{__tla as Tt}from"./DictTag-4f08045a.js";import"./color-f5b6e279.js";import{__tla as St}from"./dict-4a9940b3.js";import{__tla as xt}from"./index-a6e0da93.js";import{__tla as Bt}from"./index-3518afc7.js";let S,Lt=Promise.all([(()=>{try{return rt}catch{}})(),(()=>{try{return ot}catch{}})(),(()=>{try{return ct}catch{}})(),(()=>{try{return _t}catch{}})(),(()=>{try{return mt}catch{}})(),(()=>{try{return ft}catch{}})(),(()=>{try{return bt}catch{}})(),(()=>{try{return ht}catch{}})(),(()=>{try{return gt}catch{}})(),(()=>{try{return kt}catch{}})(),(()=>{try{return Ct}catch{}})(),(()=>{try{return zt}catch{}})(),(()=>{try{return Nt}catch{}})(),(()=>{try{return Rt}catch{}})(),(()=>{try{return Tt}catch{}})(),(()=>{try{return St}catch{}})(),(()=>{try{return xt}catch{}})(),(()=>{try{return Bt}catch{}})()]).then(async()=>{S=et(F({name:"CrmBusinessList",__name:"BusinessList",props:{bizType:{type:Number,required:!0},bizId:{type:Number,required:!0},customerId:{type:Number,required:!1}},setup(x){const d=wt(),o=x,f=_(!0),k=_(0),w=_([]),a=G({pageNo:1,pageSize:10,customerId:void 0,contactId:void 0}),y=async()=>{f.value=!0;try{a.customerId=void 0,a.contactId=void 0;let r={list:[],total:0};switch(o.bizType){case T.CRM_CUSTOMER:a.customerId=o.bizId,r=await ut(a);break;case T.CRM_CONTACT:a.contactId=o.bizId,r=await nt(a);break;default:return}w.value=r.list,k.value=r.total}finally{f.value=!1}},b=()=>{a.pageNo=1,y()},C=_(),B=()=>{C.value.open("create")},{push:L}=H(),z=_(),M=()=>{z.value.open()},U=async r=>{const s={contactId:o.bizId,businessIds:r};h.value.getSelectionRows().forEach(n=>{s.businessIds.push(n.id)}),await pt(s),d.success("\u5173\u8054\u5546\u673A\u6210\u529F"),b()},h=_(),E=async()=>{const r={contactId:o.bizId,businessIds:h.value.getSelectionRows().map(s=>s.id)};if(r.businessIds.length===0)return d.error("\u672A\u9009\u62E9\u5546\u673A");await dt(r),d.success("\u53D6\u5173\u5546\u673A\u6210\u529F"),b()};return J(()=>[o.bizId,o.bizType],()=>{b()},{immediate:!0,deep:!0}),(r,s)=>{const n=$,I=K,q=Q,c=V,D=it,P=tt,A=lt,O=st,N=X("hasPermi"),j=at;return u(),Y(W,null,[t(q,{justify:"end"},{default:l(()=>[t(I,{onClick:B},{default:l(()=>[t(n,{class:"mr-5px",icon:"ep:opportunity"}),m(" \u521B\u5EFA\u5546\u673A ")]),_:1}),e(a).contactId?g((u(),p(I,{key:0,onClick:M},{default:l(()=>[t(n,{class:"mr-5px",icon:"ep:circle-plus"}),m("\u5173\u8054 ")]),_:1})),[[N,["crm:contact:create-business"]]]):v("",!0),e(a).contactId?g((u(),p(I,{key:1,onClick:E},{default:l(()=>[t(n,{class:"mr-5px",icon:"ep:remove"}),m("\u89E3\u9664\u5173\u8054 ")]),_:1})),[[N,["crm:contact:delete-business"]]]):v("",!0)]),_:1}),t(O,{class:"mt-10px"},{default:l(()=>[g((u(),p(P,{ref_key:"businessRef",ref:h,data:e(w),stripe:!0,"show-overflow-tooltip":!0},{default:l(()=>[e(a).contactId?(u(),p(c,{key:0,type:"selection",width:"55"})):v("",!0),t(c,{label:"\u5546\u673A\u540D\u79F0",fixed:"left",align:"center",prop:"name"},{default:l(i=>[t(D,{type:"primary",underline:!1,onClick:Mt=>{return R=i.row.id,void L({name:"CrmBusinessDetail",params:{id:R}});var R}},{default:l(()=>[m(Z(i.row.name),1)]),_:2},1032,["onClick"])]),_:1}),t(c,{label:"\u5546\u673A\u91D1\u989D",align:"center",prop:"price",formatter:e(It)},null,8,["formatter"]),t(c,{label:"\u5BA2\u6237\u540D\u79F0",align:"center",prop:"customerName"}),t(c,{label:"\u5546\u673A\u7EC4",align:"center",prop:"statusTypeName"}),t(c,{label:"\u5546\u673A\u9636\u6BB5",align:"center",prop:"statusName"})]),_:1},8,["data"])),[[j,e(f)]]),t(A,{total:e(k),page:e(a).pageNo,"onUpdate:page":s[0]||(s[0]=i=>e(a).pageNo=i),limit:e(a).pageSize,"onUpdate:limit":s[1]||(s[1]=i=>e(a).pageSize=i),onPagination:y},null,8,["total","page","limit"])]),_:1}),t(yt,{ref_key:"formRef",ref:C,onSuccess:y},null,512),t(vt,{ref_key:"businessModalRef",ref:z,"customer-id":o.customerId,onSuccess:U},null,8,["customer-id"])],64)}}}),[["__file","E:/newCode/GYZX-UI-ADMIN/src/views/crm/business/components/BusinessList.vue"]])});export{Lt as __tla,S as default};
