import{d as oa,J as _a,al as na,b as ia,r as s,e as ca,p as ua,X as ma,o as d,v as C,w as r,c as H,q as fa,x as L,a,g as A,t as T,f as t,h as f,a4 as V,F as pa,am as da,an as ya,ao as ha,A as va,ak as ka,P as ga,D as ba,_ as Ca,C as xa,j as wa,I as Ta,__tla as Ua}from"./index-d5b00dc9.js";import{_ as Da,__tla as Va}from"./ContentWrap.vue_vue_type_script_setup_true_lang-29ba9b6b.js";import{b as Fa}from"./formCreate-a3356cdc.js";import{a as Pa,__tla as Sa}from"./index-6bc5a922.js";import{g as Aa,__tla as Ra}from"./index-529489f0.js";import{a as qa,r as Ba,g as Ea,__tla as ja}from"./index-d2e8c104.js";import{_ as za,__tla as Ia}from"./TaskUpdateAssigneeForm.vue_vue_type_script_setup_true_lang-8c8b0628.js";import{_ as $a,__tla as Ja}from"./ProcessInstanceBpmnViewer.vue_vue_type_style_index_0_lang-b55475af.js";import{_ as Ka,__tla as Na}from"./ProcessInstanceTaskList.vue_vue_type_script_setup_true_lang-f30d2e8f.js";import{_ as Oa,__tla as Xa}from"./TaskReturnDialogForm.vue_vue_type_script_name_TaskRollbackDialogForm_setup_true_lang-9b233b28.js";import{_ as Ya,__tla as Ga}from"./TaskDelegateForm.vue_vue_type_script_setup_true_lang-ff17a73b.js";import{_ as Ha,__tla as La}from"./TaskAddSignDialogForm.vue_vue_type_script_setup_true_lang-18b4caad.js";import{u as Ma,__tla as Qa}from"./useMessage-2288a5f2.js";import{E as Wa,__tla as Za}from"./index-bd0d9e6c.js";import{__tla as ae}from"./Dialog.vue_vue_type_style_index_0_lang-03cf6454.js";import{__tla as ee}from"./index-d569b7ba.js";import{__tla as te}from"./bpmn-embedded-fbd83e5a.js";import{__tla as re}from"./XTextButton-ae41b7bc.js";import"./_plugin-vue_export-helper-1b428a4d.js";import{__tla as le}from"./XButton-3f4aabb5.js";import{__tla as se}from"./el-collapse-item-b89b6104.js";import{__tla as oe}from"./el-link-a1231a07.js";import{__tla as _e}from"./el-drawer-1d90b9b6.js";import{__tla as ne}from"./dict-29b94c3f.js";import{__tla as ie}from"./formatTime-9063410f.js";import{__tla as ce}from"./el-timeline-item-bbad7999.js";import{__tla as ue}from"./DictTag.vue_vue_type_script_lang-2a9ae33e.js";import"./color-f5b6e279.js";import{__tla as me}from"./ProcessInstanceChildrenTaskList.vue_vue_type_script_setup_true_lang-922d2bcc.js";import{__tla as fe}from"./TaskSubSignDialogForm.vue_vue_type_script_name_TaskRollbackDialogForm_setup_true_lang-ac68ef89.js";let M,pe=Promise.all([(()=>{try{return Ua}catch{}})(),(()=>{try{return Va}catch{}})(),(()=>{try{return Sa}catch{}})(),(()=>{try{return Ra}catch{}})(),(()=>{try{return ja}catch{}})(),(()=>{try{return Ia}catch{}})(),(()=>{try{return Ja}catch{}})(),(()=>{try{return Na}catch{}})(),(()=>{try{return Xa}catch{}})(),(()=>{try{return Ga}catch{}})(),(()=>{try{return La}catch{}})(),(()=>{try{return Qa}catch{}})(),(()=>{try{return Za}catch{}})(),(()=>{try{return ae}catch{}})(),(()=>{try{return ee}catch{}})(),(()=>{try{return te}catch{}})(),(()=>{try{return re}catch{}})(),(()=>{try{return le}catch{}})(),(()=>{try{return se}catch{}})(),(()=>{try{return oe}catch{}})(),(()=>{try{return _e}catch{}})(),(()=>{try{return ne}catch{}})(),(()=>{try{return ie}catch{}})(),(()=>{try{return ce}catch{}})(),(()=>{try{return ue}catch{}})(),(()=>{try{return me}catch{}})(),(()=>{try{return fe}catch{}})()]).then(async()=>{let R,q,B,E;R={class:"el-icon-picture-outline"},q={style:{"margin-bottom":"20px","margin-left":"10%","font-size":"14px"}},B={class:"el-icon-document"},E={key:1},M=oa({name:"BpmProcessInstanceDetail",__name:"index",setup(de){const{query:Q}=_a(),F=Ma(),{proxy:W}=na(),Z=ia().getUser.id,P=Q.id,x=s(!1),o=s({}),j=s(""),S=s(!0),v=s([]),U=s([]),k=s([]),aa=ca({reason:[{required:!0,message:"\u5BA1\u6279\u5EFA\u8BAE\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),D=s(),w=s({rule:[],option:{},value:{}}),z=async(_,e)=>{const l=U.value.indexOf(_),b=W.$refs["form"+l][0],y=a(b);if(!y||!await y.validate())return;const h={id:_.id,reason:k.value[l].reason};e?(await qa(h),F.success("\u5BA1\u6279\u901A\u8FC7\u6210\u529F")):(await Ba(h),F.success("\u5BA1\u6279\u4E0D\u901A\u8FC7\u6210\u529F")),g()},I=s(),$=s(),J=s(),K=s(),g=()=>{ea(),ta()},N=s(null),ea=async()=>{try{x.value=!0;const _=await Aa(P);if(!_)return void F.error("\u67E5\u8BE2\u4E0D\u5230\u6D41\u7A0B\u4FE1\u606F\uFF01");o.value=_;const e=_.processDefinition;e.formType===10?(Fa(w,e.formConf,e.formFields,_.formVariables),da().then(()=>{var l,b,y,h,u,m;(b=(l=D.value)==null?void 0:l.fapi)==null||b.btn.show(!1),(h=(y=D.value)==null?void 0:y.fapi)==null||h.resetBtn.show(!1),(m=(u=D.value)==null?void 0:u.fapi)==null||m.disabled(!0)})):N.value=ya(_.processDefinition.formCustomViewPath),j.value=await Pa(e.id)}finally{x.value=!1}},ta=async()=>{try{S.value=!0;const _=await Ea(P);v.value=[],_.forEach(e=>{e.result!==4&&v.value.push(e)}),v.value.sort((e,l)=>e.endTime&&l.endTime?l.endTime-e.endTime:e.endTime?1:l.endTime?-1:l.createTime-e.createTime),U.value=[],k.value=[],O(v.value)}finally{S.value=!1}},O=_=>{_.forEach(e=>{ha(e.children)||O(e.children),e.result!==1&&e.result!==6||e.assigneeUser&&e.assigneeUser.id===Z&&(U.value.push({...e}),k.value.push({reason:""}))})};return ua(()=>{g()}),(_,e)=>{const l=va,b=ka,y=ga,h=ba,u=Ca,m=xa,X=wa,Y=Wa,ra=ma("form-create"),la=Da,G=Ta;return d(),C(la,null,{default:r(()=>[(d(!0),H(pa,null,fa(a(U),(i,p)=>L((d(),C(Y,{key:p,class:"box-card"},{header:r(()=>[A("span",R,"\u5BA1\u6279\u4EFB\u52A1\u3010"+T(i.name)+"\u3011",1)]),default:r(()=>[t(X,{offset:6,span:16},{default:r(()=>[t(h,{ref_for:!0,ref:"form"+p,model:a(k)[p],rules:a(aa),"label-width":"100px"},{default:r(()=>[a(o)&&a(o).name?(d(),C(l,{key:0,label:"\u6D41\u7A0B\u540D"},{default:r(()=>[f(T(a(o).name),1)]),_:1})):V("",!0),a(o)&&a(o).startUser?(d(),C(l,{key:1,label:"\u6D41\u7A0B\u53D1\u8D77\u4EBA"},{default:r(()=>[f(T(a(o).startUser.nickname)+" ",1),t(b,{size:"small",type:"info"},{default:r(()=>[f(T(a(o).startUser.deptName),1)]),_:1})]),_:1})):V("",!0),t(l,{label:"\u5BA1\u6279\u5EFA\u8BAE",prop:"reason"},{default:r(()=>[t(y,{modelValue:a(k)[p].reason,"onUpdate:modelValue":c=>a(k)[p].reason=c,placeholder:"\u8BF7\u8F93\u5165\u5BA1\u6279\u5EFA\u8BAE",type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["model","rules"]),A("div",q,[t(m,{type:"success",onClick:c=>z(i,!0)},{default:r(()=>[t(u,{icon:"ep:select"}),f(" \u901A\u8FC7 ")]),_:2},1032,["onClick"]),t(m,{type:"danger",onClick:c=>z(i,!1)},{default:r(()=>[t(u,{icon:"ep:close"}),f(" \u4E0D\u901A\u8FC7 ")]),_:2},1032,["onClick"]),t(m,{type:"primary",onClick:c=>{return n=i.id,void I.value.open(n);var n}},{default:r(()=>[t(u,{icon:"ep:edit"}),f(" \u8F6C\u529E ")]),_:2},1032,["onClick"]),t(m,{type:"primary",onClick:c=>(async n=>{$.value.open(n.id)})(i)},{default:r(()=>[t(u,{icon:"ep:position"}),f(" \u59D4\u6D3E ")]),_:2},1032,["onClick"]),t(m,{type:"primary",onClick:c=>(async n=>{K.value.open(n.id)})(i)},{default:r(()=>[t(u,{icon:"ep:plus"}),f(" \u52A0\u7B7E ")]),_:2},1032,["onClick"]),t(m,{type:"warning",onClick:c=>(async n=>{J.value.open(n.id)})(i)},{default:r(()=>[t(u,{icon:"ep:back"}),f(" \u56DE\u9000 ")]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024)),[[G,a(x)]])),128)),L((d(),C(Y,{class:"box-card"},{header:r(()=>[A("span",B,"\u7533\u8BF7\u4FE1\u606F\u3010"+T(a(o).name)+"\u3011",1)]),default:r(()=>{var i,p,c,n;return[((p=(i=a(o))==null?void 0:i.processDefinition)==null?void 0:p.formType)===10?(d(),C(X,{key:0,offset:6,span:16},{default:r(()=>[t(ra,{ref_key:"fApi",ref:D,modelValue:a(w).value,"onUpdate:modelValue":e[0]||(e[0]=sa=>a(w).value=sa),option:a(w).option,rule:a(w).rule},null,8,["modelValue","option","rule"])]),_:1})):V("",!0),((n=(c=a(o))==null?void 0:c.processDefinition)==null?void 0:n.formType)===20?(d(),H("div",E,[t(a(N),{id:a(o).businessKey},null,8,["id"])])):V("",!0)]}),_:1})),[[G,a(x)]]),t(Ka,{loading:a(S),tasks:a(v)},null,8,["loading","tasks"]),t($a,{id:`${a(P)}`,"bpmn-xml":a(j),loading:a(x),"process-instance":a(o),tasks:a(v)},null,8,["id","bpmn-xml","loading","process-instance","tasks"]),t(za,{ref_key:"taskUpdateAssigneeFormRef",ref:I,onSuccess:g},null,512),t(Oa,{ref_key:"taskReturnDialogRef",ref:J,onSuccess:g},null,512),t(Ya,{ref_key:"taskDelegateForm",ref:$,onSuccess:g},null,512),t(Ha,{ref_key:"taskAddSignDialogForm",ref:K,onSuccess:g},null,512)]),_:1})}}})});export{pe as __tla,M as default};
