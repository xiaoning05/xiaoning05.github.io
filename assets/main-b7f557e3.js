import{ao as O,d as X,r,n as W,p as Y,o as p,q as L,e as q,f as y,w as D,a as t,c as f,a0 as k,b as w,j as Z,h as F,al as P,B as J,v as K,Q as $,R as aa,_ as ea,__tla as ta}from"./index-aaa5adb3.js";import{_ as la,__tla as sa}from"./ContentWrap-04d7f6d1.js";import{R as U,__tla as ca}from"./TabNews-48dbe826.js";import ra,{__tla as ua}from"./main-356ad7a4.js";import na,{__tla as oa}from"./MsgList-808bb7ce.js";import{g as _a,__tla as ia}from"./index-c82a7d3a.js";import{a as pa}from"./profile-59eefa8f.js";import{u as ma,__tla as va}from"./useMessage-873da1e2.js";let N,S,A,da=Promise.all([(()=>{try{return ta}catch{}})(),(()=>{try{return sa}catch{}})(),(()=>{try{return ca}catch{}})(),(()=>{try{return ua}catch{}})(),(()=>{try{return oa}catch{}})(),(()=>{try{return ia}catch{}})(),(()=>{try{return va}catch{}})()]).then(async()=>{let h,z,x,T,j,R;S=u=>O.get({url:"/mp/message/page",params:u}),h=u=>($("data-v-bcccc5e5"),u=u(),aa(),u),z={key:0},x=[h(()=>y("span",{class:"el-table__empty-text"},"\u70B9\u51FB\u52A0\u8F7D\u66F4\u591A",-1))],T={key:1,class:"el-table__empty-block"},j=[h(()=>y("span",{class:"el-table__empty-text"},"\u6CA1\u6709\u66F4\u591A\u4E86",-1))],R={class:"msg-send"},N=ea(X({name:"WxMsg",__name:"main",props:{userId:{type:Number,required:!0}},setup(u){const B=ma(),I=u,m=r(-1),v=r(!1),b=r(!0),i=r([]),n=W({pageNo:1,pageSize:14,accountId:m}),_=W({nickname:"\u7528\u6237",avatar:pa,accountId:m}),V=r(!1),e=r({type:U.Text,accountId:-1,articles:[]}),C=r(null),s=r(null);Y(async()=>{var l,c;const a=await _a(I.userId);_.nickname=((l=a.nickname)==null?void 0:l.length)>0?a.nickname:_.nickname,_.avatar=((c=_.avatar)==null?void 0:c.length)>0?a.avatar:_.avatar,m.value=a.accountId,e.value.accountId=a.accountId,Q()});const E=async()=>{var l;if(!t(e))return;e.value.type===U.News&&e.value.articles&&e.value.articles.length>1&&(e.value.articles=[e.value.articles[0]],B.success("\u56FE\u6587\u6D88\u606F\u6761\u6570\u9650\u5236\u5728 1 \u6761\u4EE5\u5185\uFF0C\u5DF2\u9ED8\u8BA4\u53D1\u9001\u7B2C\u4E00\u6761"));const a=await(c=>O.post({url:"/mp/message/send",data:c}))({userId:I.userId,...e.value});V.value=!1,i.value=[...i.value,a],await M(),(l=C.value)==null||l.clear()},G=()=>{n.pageNo++,H(n,null)},H=async(a,l=null)=>{var g;v.value=!0;let c=await S(Object.assign({pageNo:a.pageNo,pageSize:a.pageSize,userId:I.userId,accountId:a.accountId},l));const d=((g=s.value)==null?void 0:g.scrollHeight)??0,o=c.list.reverse();i.value=[...o,...i.value],v.value=!1,(o.length<n.pageSize||o.length===0)&&(b.value=!1),n.pageNo=a.pageNo,n.pageSize=a.pageSize,n.pageNo===1?await M():o.length!==0&&(await P(),d!==0&&s.value&&(s.value.scrollTop=s.value.scrollHeight-d-100))},Q=()=>{H(n)},M=async()=>{await P(),s.value&&(s.value.scrollTop=s.value.scrollHeight)};return(a,l)=>{const c=J,d=la,o=K;return p(),L(d,null,{default:q(()=>[y("div",{class:"msg-div",ref_key:"msgDivRef",ref:s},[D(y("div",null,null,512),[[o,t(v)]]),t(v)?k("",!0):(p(),f("div",z,[t(b)?(p(),f("div",{key:0,class:"el-table__empty-block",onClick:G},[...x])):k("",!0),t(b)?k("",!0):(p(),f("div",T,[...j]))])),w(na,{list:t(i),"account-id":t(m),user:t(_)},null,8,["list","account-id","user"])],512),D((p(),f("div",R,[w(t(ra),{ref_key:"replySelectRef",ref:C,modelValue:t(e),"onUpdate:modelValue":l[0]||(l[0]=g=>Z(e)?e.value=g:null)},null,8,["modelValue"]),w(c,{type:"success",class:"send-but",onClick:E},{default:q(()=>[F("\u53D1\u9001(S)")]),_:1})])),[[o,t(V)]])]),_:1})}}}),[["__scopeId","data-v-bcccc5e5"],["__file","E:/newCode/GYZX-UI-ADMIN/src/views/mp/components/wx-msg/main.vue"]]),A=Object.freeze(Object.defineProperty({__proto__:null,default:N},Symbol.toStringTag,{value:"Module"}))});export{N as W,da as __tla,S as g,A as m};
