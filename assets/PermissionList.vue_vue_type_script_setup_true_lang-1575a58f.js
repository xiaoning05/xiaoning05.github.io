import{d as D,r as n,dW as G,aS as R,o as _,c as H,v as m,w as p,a as s,f as r,h as b,a4 as g,x as V,H as j,F as J,_ as K,C as Q,k as X,G as Y,I as Z,__tla as $}from"./index-d2088aec.js";import{_ as ee,__tla as ae}from"./DictTag.vue_vue_type_script_lang-754cee6f.js";import{d as te,__tla as le}from"./formatTime-c7e0c543.js";import{P as f,g as re,d as se,a as ie,__tla as ne}from"./index-05c907cf.js";import{_ as oe,__tla as ue}from"./PermissionForm.vue_vue_type_script_setup_true_lang-2f5a6ef5.js";import{D as ce,__tla as de}from"./dict-999fbee6.js";import{u as _e,__tla as pe}from"./useMessage-c5990e2c.js";let C,ve=Promise.all([(()=>{try{return $}catch{}})(),(()=>{try{return ae}catch{}})(),(()=>{try{return le}catch{}})(),(()=>{try{return ne}catch{}})(),(()=>{try{return ue}catch{}})(),(()=>{try{return de}catch{}})(),(()=>{try{return pe}catch{}})()]).then(async()=>{C=D({name:"CrmPermissionList",__name:"PermissionList",props:{bizType:{},bizId:{},showAction:{type:Boolean}},emits:["quitTeam"],setup(x,{expose:N,emit:U}){const o=_e(),u=x,I=n(!0),i=n([]),W=n({ownerUserId:0}),y=G(),k=async()=>{I.value=!0;try{const e=await re({bizType:u.bizType,bizId:u.bizId});i.value=e,i.value.find(a=>a.userId===y.getUser.id&&a.level===f.OWNER)&&(W.value.ownerUserId=y.getUser.id)}finally{I.value=!1}},c=n([]),T=n(),O=e=>{var a;if(e.findIndex(t=>t.level===f.OWNER)!==-1)return o.warning("\u4E0D\u80FD\u9009\u62E9\u8D1F\u8D23\u4EBA\uFF01"),void((a=T.value)==null?void 0:a.clearSelection());c.value=e},z=n(),P=()=>{var e,a,t;((e=c.value)==null?void 0:e.length)!==0?((a=c.value)==null?void 0:a.length)>1?o.warning("\u7F16\u8F91\u56E2\u961F\u6210\u5458\u65F6\u53EA\u80FD\u9009\u62E9\u4E00\u4E2A\uFF01"):(t=z.value)==null||t.open0("update",u.bizType,u.bizId,c.value[0].id,c.value[0].level):o.warning("\u8BF7\u5148\u9009\u62E9\u56E2\u961F\u6210\u5458\u540E\u64CD\u4F5C\uFF01")},S=async()=>{var a,t;if(((a=c.value)==null?void 0:a.length)===0)return void o.warning("\u8BF7\u5148\u9009\u62E9\u56E2\u961F\u6210\u5458\u540E\u64CD\u4F5C\uFF01");await o.delConfirm();const e=(t=c.value)==null?void 0:t.map(l=>l.id);await se(e),o.success("\u79FB\u9664\u56E2\u961F\u6210\u5458\u6210\u529F\uFF01"),await k()},E=()=>{var e;(e=z.value)==null||e.open("create",u.bizType,u.bizId)},d=n(!1),h=n(!1),w=n(!1);R(i,e=>{var a;if(w.value=!1,(e==null?void 0:e.length)>0){w.value=!i.value.some(l=>l.level===f.OWNER),d.value=!1,h.value=!1;const t=(a=y.getUser)==null?void 0:a.id;i.value.filter(l=>l.userId===t).forEach(l=>{l.level===f.OWNER?(d.value=!0,h.value=!0):l.level===f.WRITE&&(h.value=!0)})}else w.value=!0},{immediate:!0}),N({openForm:E,validateOwnerUser:d,validateWrite:h,isPool:w});const L=U,q=async()=>{if(i.value.find(a=>a.userId===y.getUser.id&&a.level===f.OWNER))return void o.warning("\u8D1F\u8D23\u4EBA\u4E0D\u80FD\u9000\u51FA\u56E2\u961F\uFF01");const e=i.value.find(a=>a.userId===y.getUser.id);e&&(await ie(e.id),o.success("\u9000\u51FA\u56E2\u961F\u6210\u5458\u6210\u529F\uFF01"),L("quitTeam"))};return R(()=>u.bizId,e=>{e&&k()},{immediate:!0,deep:!0}),(e,a)=>{const t=K,l=Q,A=X,v=Y,F=ee,M=Z;return _(),H(J,null,[e.showAction?(_(),m(A,{key:0,justify:"end"},{default:p(()=>[s(d)?(_(),m(l,{key:0,type:"primary",onClick:E},{default:p(()=>[r(t,{class:"mr-5px",icon:"ep:plus"}),b(" \u65B0\u589E ")]),_:1})):g("",!0),s(d)?(_(),m(l,{key:1,onClick:P},{default:p(()=>[r(t,{class:"mr-5px",icon:"ep:edit"}),b(" \u7F16\u8F91 ")]),_:1})):g("",!0),s(d)?(_(),m(l,{key:2,onClick:S},{default:p(()=>[r(t,{class:"mr-5px",icon:"ep:delete"}),b(" \u79FB\u9664 ")]),_:1})):g("",!0),!s(d)&&s(i).length>0?(_(),m(l,{key:3,type:"danger",onClick:q},{default:p(()=>[b(" \u9000\u51FA\u56E2\u961F ")]),_:1})):g("",!0)]),_:1})):g("",!0),V((_(),m(s(j),{ref_key:"elTableRef",ref:T,data:s(i),"show-overflow-tooltip":!0,stripe:!0,class:"mt-20px",onSelectionChange:O},{default:p(()=>[r(v,{type:"selection",width:"55"}),r(v,{align:"center",label:"\u59D3\u540D",prop:"nickname"}),r(v,{align:"center",label:"\u90E8\u95E8",prop:"deptName"}),r(v,{align:"center",label:"\u5C97\u4F4D",prop:"postNames"}),r(v,{align:"center",label:"\u6743\u9650\u7EA7\u522B",prop:"level"},{default:p(({row:B})=>[r(F,{type:s(ce).CRM_PERMISSION_LEVEL,value:B.level},null,8,["type","value"])]),_:1}),r(v,{formatter:s(te),align:"center",label:"\u52A0\u5165\u65F6\u95F4",prop:"createTime"},null,8,["formatter"])]),_:1},8,["data"])),[[M,s(I)]]),r(oe,{ref_key:"formRef",ref:z,onSuccess:k},null,512)],64)}}})});export{C as _,ve as __tla};
