import{d as O,r as p,e as Z,aS as j,o as P,c as q,x as B,a as m,v as U,w as a,f as e,dZ as h,h as V,a4 as D,F as G,d_ as H,G as J,P as K,A as M,bZ as Q,C as W,H as X,D as Y,k as ee,I as ae,__tla as le}from"./index-d2088aec.js";import{_ as te,__tla as re}from"./SaleOutReceiptEnableList.vue_vue_type_script_setup_true_lang-4bfd8962.js";import{_ as ie,__tla as oe}from"./SaleReturnRefundEnableList.vue_vue_type_script_setup_true_lang-23ca6dfd.js";import{E as v}from"./constants-99751ef9.js";import{u as de,__tla as se}from"./useMessage-c5990e2c.js";let g,ce=Promise.all([(()=>{try{return le}catch{}})(),(()=>{try{return re}catch{}})(),(()=>{try{return oe}catch{}})(),(()=>{try{return se}catch{}})()]).then(async()=>{g=O({__name:"FinanceReceiptItemForm",props:{items:{},customerId:{},disabled:{type:Boolean}},setup(I,{expose:R}){const _=I,y=de(),z=p(!1),c=p([]),E=Z({receiptPrice:[{required:!0,message:"\u672C\u6B21\u6536\u6B3E\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),x=p([]);p([]),j(()=>_.items,async r=>{c.value=r},{immediate:!0});const N=r=>{const{columns:l,data:o}=r,d=[];return l.forEach((s,u)=>{if(u!==0)if(["totalPrice","receiptedPrice","receiptPrice"].includes(s.property)){const f=H(o.map(b=>Number(b[s.property])));d[u]=h(f)}else d[u]="";else d[u]="\u5408\u8BA1"}),d},w=p(),S=()=>{_.customerId?w.value.open(_.customerId):y.error("\u8BF7\u9009\u62E9\u5BA2\u6237")},C=r=>{r.forEach(l=>{c.value.push({bizId:l.id,bizType:v.SALE_OUT,bizNo:l.no,totalPrice:l.totalPrice,receiptedPrice:l.receiptPrice,receiptPrice:l.totalPrice-l.receiptPrice})})},k=p(),$=()=>{_.customerId?k.value.open(_.customerId):y.error("\u8BF7\u9009\u62E9\u5BA2\u6237")},L=r=>{r.forEach(l=>{c.value.push({bizId:l.id,bizType:v.SALE_RETURN,bizNo:l.no,totalPrice:-l.totalPrice,receiptedPrice:-l.refundPrice,receiptPrice:-l.totalPrice+l.refundPrice})})};return R({validate:()=>x.value.validate()}),(r,l)=>{const o=J,d=K,s=M,u=Q,f=W,b=X,T=Y,A=ee,F=ae;return P(),q(G,null,[B((P(),U(T,{ref_key:"formRef",ref:x,model:m(c),rules:m(E),"label-width":"0px","inline-message":!0,disabled:r.disabled},{default:a(()=>[e(b,{data:m(c),"show-summary":"","summary-method":N,class:"-mt-10px"},{default:a(()=>[e(o,{label:"\u5E8F\u53F7",type:"index",align:"center",width:"60"}),e(o,{label:"\u9500\u552E\u5355\u636E\u7F16\u53F7","min-width":"200"},{default:a(({row:t})=>[e(s,{class:"mb-0px!"},{default:a(()=>[e(d,{disabled:"",modelValue:t.bizNo,"onUpdate:modelValue":i=>t.bizNo=i},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:1}),e(o,{label:"\u5E94\u4ED8\u91D1\u989D",prop:"totalPrice",fixed:"right","min-width":"100"},{default:a(({row:t})=>[e(s,{class:"mb-0px!"},{default:a(()=>[e(d,{disabled:"",modelValue:t.totalPrice,"onUpdate:modelValue":i=>t.totalPrice=i,formatter:m(h)},null,8,["modelValue","onUpdate:modelValue","formatter"])]),_:2},1024)]),_:1}),e(o,{label:"\u5DF2\u4ED8\u91D1\u989D",prop:"receiptedPrice",fixed:"right","min-width":"100"},{default:a(({row:t})=>[e(s,{class:"mb-0px!"},{default:a(()=>[e(d,{disabled:"",modelValue:t.receiptedPrice,"onUpdate:modelValue":i=>t.receiptedPrice=i,formatter:m(h)},null,8,["modelValue","onUpdate:modelValue","formatter"])]),_:2},1024)]),_:1}),e(o,{label:"\u672C\u6B21\u6536\u6B3E",prop:"receiptPrice",fixed:"right","min-width":"115"},{default:a(({row:t,$index:i})=>[e(s,{prop:`${i}.receiptPrice`,class:"mb-0px!"},{default:a(()=>[e(u,{modelValue:t.receiptPrice,"onUpdate:modelValue":n=>t.receiptPrice=n,"controls-position":"right",precision:2,class:"!w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:1}),e(o,{label:"\u5907\u6CE8","min-width":"150"},{default:a(({row:t,$index:i})=>[e(s,{prop:`${i}.remark`,class:"mb-0px!"},{default:a(()=>[e(d,{modelValue:t.remark,"onUpdate:modelValue":n=>t.remark=n,placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:1}),e(o,{align:"center",fixed:"right",label:"\u64CD\u4F5C",width:"60"},{default:a(({$index:t})=>[e(f,{onClick:i=>{return n=t,void c.value.splice(n,1);var n},link:""},{default:a(()=>[V("\u2014")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["model","rules","disabled"])),[[F,m(z)]]),r.disabled?D("",!0):(P(),U(A,{key:0,justify:"center",class:"mt-3"},{default:a(()=>[e(f,{onClick:S,round:""},{default:a(()=>[V("+ \u6DFB\u52A0\u9500\u552E\u51FA\u5E93\u5355")]),_:1}),e(f,{onClick:$,round:""},{default:a(()=>[V("+ \u6DFB\u52A0\u9500\u552E\u9000\u8D27\u5355")]),_:1})]),_:1})),e(te,{ref_key:"saleOutReceiptEnableListRef",ref:w,onSuccess:C},null,512),e(ie,{ref_key:"saleReturnRefundEnableListRef",ref:k,onSuccess:L},null,512)],64)}}})});export{g as _,ce as __tla};
