import{d as M,ag as P,r as B,aS as F,o as u,c as V,v as h,w as r,a as m,a4 as g,F as v,f as t,q as N,g as S,t as p,h as f,H as T,aJ as Q,dF as X,G as Y,P as ee,bZ as le,C as ae,__tla as te}from"./index-d2088aec.js";import{E as ie,__tla as re}from"./el-image-9c436071.js";import{__tla as oe}from"./el-image-viewer-6188d22b.js";import{_ as ne,__tla as se}from"./UploadImg-c6bc4a21.js";import{__tla as ce}from"./UploadImgs.vue_vue_type_style_index_0_scoped_78c552d7_lang-c3ac64a1.js";import{__tla as de}from"./UploadFile.vue_vue_type_style_index_0_scoped_3311e906_lang-1f0a110b.js";import{c as ue,__tla as me}from"./index-b484ae95.js";import{u as pe,__tla as fe}from"./useMessage-c5990e2c.js";let j,he=Promise.all([(()=>{try{return te}catch{}})(),(()=>{try{return re}catch{}})(),(()=>{try{return oe}catch{}})(),(()=>{try{return se}catch{}})(),(()=>{try{return ce}catch{}})(),(()=>{try{return de}catch{}})(),(()=>{try{return me}catch{}})(),(()=>{try{return fe}catch{}})()]).then(async()=>{let A,O,z;A={style:{"font-weight":"bold",color:"#40aaff"}},O={style:{"font-weight":"bold",color:"#40aaff"}},z={style:{"font-weight":"bold",color:"#40aaff"}},j=M({name:"SkuList",__name:"SkuList",props:{propFormData:{type:Object,default:()=>{}},propertyList:{type:Array,default:()=>[]},ruleConfig:{type:Array,default:()=>[]},isBatch:P.bool.def(!1),isDetail:P.bool.def(!1),isComponent:P.bool.def(!1),isActivityComponent:P.bool.def(!1)},emits:["selectionChange"],setup(w,{expose:R,emit:G}){const Z=pe(),b=w,c=B(),x=B([{price:0,marketPrice:0,costPrice:0,barCode:"",picUrl:"",stock:0,weight:0,volume:0,firstBrokeragePrice:0,secondBrokeragePrice:0}]),D=i=>{ue({zIndex:9999999,urlList:[i]})},$=()=>{c.value.skus.forEach(i=>{X(i,x.value[0])})},U=B([]),q=(i,d)=>{const e=d.split(".");let o=i;for(const n of e){if(!o||typeof o!="object"||!(n in o)){o=void 0;break}o=o[n]}return o},H=G,W=i=>{H("selectionChange",i)};F(()=>b.propFormData,i=>{i&&(c.value=i)},{deep:!0,immediate:!0});const E=i=>{const d=i.map(o=>o.values.map(n=>({propertyId:o.id,propertyName:o.name,valueId:n.id,valueName:n.name}))),e=J(d);I(i)||(c.value.skus=[]);for(const o of e){const n={properties:Array.isArray(o)?o:[o],price:0,marketPrice:0,costPrice:0,barCode:"",picUrl:"",stock:0,weight:0,volume:0,firstBrokeragePrice:0,secondBrokeragePrice:0};c.value.skus.findIndex(k=>JSON.stringify(k.properties)===JSON.stringify(n.properties))===-1&&c.value.skus.push(n)}},I=i=>{const d=[];c.value.skus.forEach(o=>{var n,k;return(k=(n=o.properties)==null?void 0:n.map(y=>y.propertyId))==null?void 0:k.forEach(y=>{d.indexOf(y)===-1&&d.push(y)})});const e=i.map(o=>o.id);return d.length===e.length},J=i=>{if(i.length===0)return[];if(i.length===1)return i[0];{const d=[],e=J(i.slice(1));for(let o=0;o<i[0].length;o++)for(let n=0;n<e.length;n++)Array.isArray(e[n])?d.push([i[0][o],...e[n]]):d.push([i[0][o],e[n]]);return d}};F(()=>b.propertyList,i=>{c.value.specType&&(b.isBatch&&(x.value=[{price:0,marketPrice:0,costPrice:0,barCode:"",picUrl:"",stock:0,weight:0,volume:0,firstBrokeragePrice:0,secondBrokeragePrice:0}]),JSON.stringify(i)!=="[]"&&(U.value=[],i.forEach((d,e)=>{U.value.push({prop:`name${e}`,label:d.name})}),I(i)||i.some(d=>d.values.length===0)||E(i)))},{deep:!0,immediate:!0});const L=B();return R({generateTableData:E,validateSku:()=>{let i="\u8BF7\u68C0\u67E5\u5546\u54C1\u5404\u884C\u76F8\u5173\u5C5E\u6027\u914D\u7F6E\uFF0C",d=!0;for(const e of c.value.skus){for(const o of b==null?void 0:b.ruleConfig){const n=q(e,o.name);if(!o.rule(n)){d=!1,i+=o.message;break}}if(!d)throw Z.warning(i),new Error(i)}},getSkuTableRef:()=>L.value}),(i,d)=>{const e=Y,o=ee,n=le,k=ae,y=ie;return u(),V(v,null,[w.isDetail||w.isActivityComponent?g("",!0):(u(),h(m(T),{key:0,data:w.isBatch?m(x):m(c).skus,border:"",class:"tabNumWidth","max-height":"500",size:"small"},{default:r(()=>{var l;return[t(e,{align:"center",label:"\u56FE\u7247","min-width":"65"},{default:r(({row:a})=>[t(m(ne),{modelValue:a.picUrl,"onUpdate:modelValue":s=>a.picUrl=s,height:"50px",width:"50px"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),m(c).specType&&!w.isBatch?(u(!0),V(v,{key:0},N(m(U),(a,s)=>(u(),h(e,{key:s,label:a.label,align:"center","min-width":"120"},{default:r(({row:_})=>{var C;return[S("span",A,p((C=_.properties[s])==null?void 0:C.valueName),1)]}),_:2},1032,["label"]))),128)):g("",!0),t(e,{align:"center",label:"\u5546\u54C1\u6761\u7801","min-width":"168"},{default:r(({row:a})=>[t(o,{modelValue:a.barCode,"onUpdate:modelValue":s=>a.barCode=s,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(e,{align:"center",label:"\u9500\u552E\u4EF7","min-width":"168"},{default:r(({row:a})=>[t(n,{modelValue:a.price,"onUpdate:modelValue":s=>a.price=s,min:0,precision:2,step:.1,class:"w-100%","controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(e,{align:"center",label:"\u5E02\u573A\u4EF7","min-width":"168"},{default:r(({row:a})=>[t(n,{modelValue:a.marketPrice,"onUpdate:modelValue":s=>a.marketPrice=s,min:0,precision:2,step:.1,class:"w-100%","controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(e,{align:"center",label:"\u6210\u672C\u4EF7","min-width":"168"},{default:r(({row:a})=>[t(n,{modelValue:a.costPrice,"onUpdate:modelValue":s=>a.costPrice=s,min:0,precision:2,step:.1,class:"w-100%","controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(e,{align:"center",label:"\u5E93\u5B58","min-width":"168"},{default:r(({row:a})=>[t(n,{modelValue:a.stock,"onUpdate:modelValue":s=>a.stock=s,min:0,class:"w-100%","controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(e,{align:"center",label:"\u91CD\u91CF(kg)","min-width":"168"},{default:r(({row:a})=>[t(n,{modelValue:a.weight,"onUpdate:modelValue":s=>a.weight=s,min:0,precision:2,step:.1,class:"w-100%","controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(e,{align:"center",label:"\u4F53\u79EF(m^3)","min-width":"168"},{default:r(({row:a})=>[t(n,{modelValue:a.volume,"onUpdate:modelValue":s=>a.volume=s,min:0,precision:2,step:.1,class:"w-100%","controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),m(c).subCommissionType?(u(),V(v,{key:1},[t(e,{align:"center",label:"\u4E00\u7EA7\u8FD4\u4F63(\u5143)","min-width":"168"},{default:r(({row:a})=>[t(n,{modelValue:a.firstBrokeragePrice,"onUpdate:modelValue":s=>a.firstBrokeragePrice=s,min:0,precision:2,step:.1,class:"w-100%","controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(e,{align:"center",label:"\u4E8C\u7EA7\u8FD4\u4F63(\u5143)","min-width":"168"},{default:r(({row:a})=>[t(n,{modelValue:a.secondBrokeragePrice,"onUpdate:modelValue":s=>a.secondBrokeragePrice=s,min:0,precision:2,step:.1,class:"w-100%","controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})],64)):g("",!0),(l=m(c))!=null&&l.specType?(u(),h(e,{key:2,align:"center",fixed:"right",label:"\u64CD\u4F5C",width:"80"},{default:r(({row:a})=>[w.isBatch?(u(),h(k,{key:0,link:"",size:"small",type:"primary",onClick:$},{default:r(()=>[f(" \u6279\u91CF\u6DFB\u52A0 ")]),_:1})):(u(),h(k,{key:1,link:"",size:"small",type:"primary",onClick:s=>(_=>{const C=c.value.skus.findIndex(K=>JSON.stringify(K.properties)===JSON.stringify(_.properties));c.value.skus.splice(C,1)})(a)},{default:r(()=>[f("\u5220\u9664")]),_:2},1032,["onClick"]))]),_:1})):g("",!0)]}),_:1},8,["data"])),w.isDetail?(u(),h(m(T),{key:1,ref_key:"activitySkuListRef",ref:L,data:m(c).skus,border:"","max-height":"500",size:"small",style:{width:"99%"},onSelectionChange:W},{default:r(()=>[w.isComponent?(u(),h(e,{key:0,type:"selection",width:"45"})):g("",!0),t(e,{align:"center",label:"\u56FE\u7247","min-width":"80"},{default:r(({row:l})=>[l.picUrl?(u(),h(y,{key:0,src:l.picUrl,class:"h-50px w-50px",onClick:a=>D(l.picUrl)},null,8,["src","onClick"])):g("",!0)]),_:1}),m(c).specType&&!w.isBatch?(u(!0),V(v,{key:1},N(m(U),(l,a)=>(u(),h(e,{key:a,label:l.label,align:"center","min-width":"80"},{default:r(({row:s})=>{var _;return[S("span",O,p((_=s.properties[a])==null?void 0:_.valueName),1)]}),_:2},1032,["label"]))),128)):g("",!0),t(e,{align:"center",label:"\u5546\u54C1\u6761\u7801","min-width":"100"},{default:r(({row:l})=>[f(p(l.barCode),1)]),_:1}),t(e,{align:"center",label:"\u9500\u552E\u4EF7(\u5143)","min-width":"80"},{default:r(({row:l})=>[f(p(l.price),1)]),_:1}),t(e,{align:"center",label:"\u5E02\u573A\u4EF7(\u5143)","min-width":"80"},{default:r(({row:l})=>[f(p(l.marketPrice),1)]),_:1}),t(e,{align:"center",label:"\u6210\u672C\u4EF7(\u5143)","min-width":"80"},{default:r(({row:l})=>[f(p(l.costPrice),1)]),_:1}),t(e,{align:"center",label:"\u5E93\u5B58","min-width":"80"},{default:r(({row:l})=>[f(p(l.stock),1)]),_:1}),t(e,{align:"center",label:"\u91CD\u91CF(kg)","min-width":"80"},{default:r(({row:l})=>[f(p(l.weight),1)]),_:1}),t(e,{align:"center",label:"\u4F53\u79EF(m^3)","min-width":"80"},{default:r(({row:l})=>[f(p(l.volume),1)]),_:1}),m(c).subCommissionType?(u(),V(v,{key:2},[t(e,{align:"center",label:"\u4E00\u7EA7\u8FD4\u4F63(\u5143)","min-width":"80"},{default:r(({row:l})=>[f(p(l.firstBrokeragePrice),1)]),_:1}),t(e,{align:"center",label:"\u4E8C\u7EA7\u8FD4\u4F63(\u5143)","min-width":"80"},{default:r(({row:l})=>[f(p(l.secondBrokeragePrice),1)]),_:1})],64)):g("",!0)]),_:1},8,["data"])):g("",!0),w.isActivityComponent?(u(),h(m(T),{key:2,data:m(c).skus,border:"","max-height":"500",size:"small",style:{width:"99%"}},{default:r(()=>[w.isComponent?(u(),h(e,{key:0,type:"selection",width:"45"})):g("",!0),t(e,{align:"center",label:"\u56FE\u7247","min-width":"80"},{default:r(({row:l})=>[t(y,{src:l.picUrl,class:"h-60px w-60px",onClick:a=>D(l.picUrl)},null,8,["src","onClick"])]),_:1}),m(c).specType?(u(!0),V(v,{key:1},N(m(U),(l,a)=>(u(),h(e,{key:a,label:l.label,align:"center","min-width":"80"},{default:r(({row:s})=>{var _;return[S("span",z,p((_=s.properties[a])==null?void 0:_.valueName),1)]}),_:2},1032,["label"]))),128)):g("",!0),t(e,{align:"center",label:"\u5546\u54C1\u6761\u7801","min-width":"100"},{default:r(({row:l})=>[f(p(l.barCode),1)]),_:1}),t(e,{align:"center",label:"\u9500\u552E\u4EF7(\u5143)","min-width":"80"},{default:r(({row:l})=>[f(p(l.price),1)]),_:1}),t(e,{align:"center",label:"\u5E02\u573A\u4EF7(\u5143)","min-width":"80"},{default:r(({row:l})=>[f(p(l.marketPrice),1)]),_:1}),t(e,{align:"center",label:"\u6210\u672C\u4EF7(\u5143)","min-width":"80"},{default:r(({row:l})=>[f(p(l.costPrice),1)]),_:1}),t(e,{align:"center",label:"\u5E93\u5B58","min-width":"80"},{default:r(({row:l})=>[f(p(l.stock),1)]),_:1}),Q(i.$slots,"extension")]),_:3},8,["data"])):g("",!0)],64)}}})});export{j as _,he as __tla};
