import{d as F,r as n,dY as Y,aT as C,o as d,c as B,v,w as p,a as i,f as r,h as I,a5 as g,x as G,I as H,F as J,C as V,D as X,k as Z,H as K,J as Q,_ as $,__tla as ee}from"./index-f0743f71.js";import{_ as ae,__tla as te}from"./DictTag-4f08045a.js";import{d as le,__tla as re}from"./formatTime-e6df2ea5.js";import{P as f,g as ie,d as se,a as ne,__tla as oe}from"./index-123b98f8.js";import ue,{__tla as ce}from"./PermissionForm-b1e340c0.js";import{D as _e,__tla as de}from"./dict-4a9940b3.js";import{u as pe,__tla as me}from"./useMessage-75a00a06.js";import"./color-f5b6e279.js";import{__tla as ve}from"./Dialog-8f786edd.js";import{__tla as fe}from"./index-5f468446.js";let N,ye=Promise.all([(()=>{try{return ee}catch{}})(),(()=>{try{return te}catch{}})(),(()=>{try{return re}catch{}})(),(()=>{try{return oe}catch{}})(),(()=>{try{return ce}catch{}})(),(()=>{try{return de}catch{}})(),(()=>{try{return me}catch{}})(),(()=>{try{return ve}catch{}})(),(()=>{try{return fe}catch{}})()]).then(async()=>{N=$(F({name:"CrmPermissionList",__name:"PermissionList",props:{bizType:{type:Number,required:!0},bizId:{type:null,required:!0},showAction:{type:Boolean,required:!0}},emits:["quitTeam"],setup(R,{expose:U,emit:x}){const o=pe(),u=R,b=n(!0),s=n([]),O=n({ownerUserId:0}),y=Y(),k=async()=>{b.value=!0;try{const e=await ie({bizType:u.bizType,bizId:u.bizId});s.value=e,s.value.find(a=>a.userId===y.getUser.id&&a.level===f.OWNER)&&(O.value.ownerUserId=y.getUser.id)}finally{b.value=!1}},c=n([]),z=n(),P=e=>{var a;if(e.findIndex(t=>t.level===f.OWNER)!==-1)return o.warning("\u4E0D\u80FD\u9009\u62E9\u8D1F\u8D23\u4EBA\uFF01"),void((a=z.value)==null?void 0:a.clearSelection());c.value=e},T=n(),W=()=>{var e,a,t;((e=c.value)==null?void 0:e.length)!==0?((a=c.value)==null?void 0:a.length)>1?o.warning("\u7F16\u8F91\u56E2\u961F\u6210\u5458\u65F6\u53EA\u80FD\u9009\u62E9\u4E00\u4E2A\uFF01"):(t=T.value)==null||t.open0("update",u.bizType,u.bizId,c.value[0].id,c.value[0].level):o.warning("\u8BF7\u5148\u9009\u62E9\u56E2\u961F\u6210\u5458\u540E\u64CD\u4F5C\uFF01")},q=async()=>{var a,t;if(((a=c.value)==null?void 0:a.length)===0)return void o.warning("\u8BF7\u5148\u9009\u62E9\u56E2\u961F\u6210\u5458\u540E\u64CD\u4F5C\uFF01");await o.delConfirm();const e=(t=c.value)==null?void 0:t.map(l=>l.id);await se(e),o.success("\u79FB\u9664\u56E2\u961F\u6210\u5458\u6210\u529F\uFF01"),await k()},E=()=>{var e;(e=T.value)==null||e.open("create",u.bizType,u.bizId)},_=n(!1),h=n(!1),w=n(!1);C(s,e=>{var a;if(w.value=!1,(e==null?void 0:e.length)>0){w.value=!s.value.some(l=>l.level===f.OWNER),_.value=!1,h.value=!1;const t=(a=y.getUser)==null?void 0:a.id;s.value.filter(l=>l.userId===t).forEach(l=>{l.level===f.OWNER?(_.value=!0,h.value=!0):l.level===f.WRITE&&(h.value=!0)})}else w.value=!0},{immediate:!0}),U({openForm:E,validateOwnerUser:_,validateWrite:h,isPool:w});const L=x,S=async()=>{if(s.value.find(a=>a.userId===y.getUser.id&&a.level===f.OWNER))return void o.warning("\u8D1F\u8D23\u4EBA\u4E0D\u80FD\u9000\u51FA\u56E2\u961F\uFF01");const e=s.value.find(a=>a.userId===y.getUser.id);e&&(await ne(e.id),o.success("\u9000\u51FA\u56E2\u961F\u6210\u5458\u6210\u529F\uFF01"),L("quitTeam"))};return C(()=>u.bizId,e=>{e&&k()},{immediate:!0,deep:!0}),(e,a)=>{const t=V,l=X,A=Z,m=K,D=ae,M=Q;return d(),B(J,null,[e.showAction?(d(),v(A,{key:0,justify:"end"},{default:p(()=>[i(_)?(d(),v(l,{key:0,type:"primary",onClick:E},{default:p(()=>[r(t,{class:"mr-5px",icon:"ep:plus"}),I(" \u65B0\u589E ")]),_:1})):g("",!0),i(_)?(d(),v(l,{key:1,onClick:W},{default:p(()=>[r(t,{class:"mr-5px",icon:"ep:edit"}),I(" \u7F16\u8F91 ")]),_:1})):g("",!0),i(_)?(d(),v(l,{key:2,onClick:q},{default:p(()=>[r(t,{class:"mr-5px",icon:"ep:delete"}),I(" \u79FB\u9664 ")]),_:1})):g("",!0),!i(_)&&i(s).length>0?(d(),v(l,{key:3,type:"danger",onClick:S},{default:p(()=>[I(" \u9000\u51FA\u56E2\u961F ")]),_:1})):g("",!0)]),_:1})):g("",!0),G((d(),v(i(H),{ref_key:"elTableRef",ref:z,data:i(s),"show-overflow-tooltip":!0,stripe:!0,class:"mt-20px",onSelectionChange:P},{default:p(()=>[r(m,{type:"selection",width:"55"}),r(m,{align:"center",label:"\u59D3\u540D",prop:"nickname"}),r(m,{align:"center",label:"\u90E8\u95E8",prop:"deptName"}),r(m,{align:"center",label:"\u5C97\u4F4D",prop:"postNames"}),r(m,{align:"center",label:"\u6743\u9650\u7EA7\u522B",prop:"level"},{default:p(({row:j})=>[r(D,{type:i(_e).CRM_PERMISSION_LEVEL,value:j.level},null,8,["type","value"])]),_:1}),r(m,{formatter:i(le),align:"center",label:"\u52A0\u5165\u65F6\u95F4",prop:"createTime"},null,8,["formatter"])]),_:1},8,["data"])),[[M,i(b)]]),r(ue,{ref_key:"formRef",ref:T,onSuccess:k},null,512)],64)}}}),[["__file","E:/newCode/GYZX-UI-ADMIN/src/views/crm/permission/components/PermissionList.vue"]])});export{ye as __tla,N as default};
