import{i as ee,bV as te,al as ne,r as t,e as J,a1 as re,aS as Ie,p as oe,o as T,c as _,a as e,av as x,g as s,x as ae,a3 as ie,f as $e,w as Oe,R as Q,t as L,a4 as K,S as _e,am as ce,dn as ue,dp as pe,F as Ce,q as Be,b8 as Ne,h as Ee,v as Ve,aQ as je,__tla as De}from"./index-d2088aec.js";import{C as R,__tla as Je}from"./index-a70e1e2c.js";import{_ as Le}from"./_plugin-vue_export-helper-1b428a4d.js";let ve,Me=Promise.all([(()=>{try{return De}catch{}})(),(()=>{try{return Je}catch{}})()]).then(async()=>{function q(i,g="XwKsGlMcdPMEhR1B"){const l=R.enc.Utf8.parse(g),o=R.enc.Utf8.parse(i);return R.AES.encrypt(o,l,{mode:R.mode.ECB,padding:R.pad.Pkcs7}).toString()}function le(i){let g,l,o,h;const n=window,c=i.$el.parentNode.offsetWidth||n.offsetWidth,f=i.$el.parentNode.offsetHeight||n.offsetHeight;return g=i.imgSize.width.indexOf("%")!=-1?parseInt(i.imgSize.width)/100*c+"px":i.imgSize.width,l=i.imgSize.height.indexOf("%")!=-1?parseInt(i.imgSize.height)/100*f+"px":i.imgSize.height,o=i.barSize.width.indexOf("%")!=-1?parseInt(i.barSize.width)/100*c+"px":i.barSize.width,h=i.barSize.height.indexOf("%")!=-1?parseInt(i.barSize.height)/100*f+"px":i.barSize.height,{imgWidth:g,imgHeight:l,barWidth:o,barHeight:h}}const he={style:{position:"relative"}},de=["src"],ge=[s("i",{class:"iconfont icon-refresh"},null,-1)],fe=["textContent"],ye=["textContent"],me=["src"],be={__name:"VerifySlide",props:{captchaType:{type:String},type:{type:String,default:"1"},mode:{type:String,default:"fixed"},vSpace:{type:Number,default:5},explain:{type:String,default:""},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},blockSize:{type:Object,default:()=>({width:"50px",height:"50px"})},barSize:{type:Object,default:()=>({width:"310px",height:"30px"})}},setup(i){const g=i,{t:l}=ee(),{mode:o,captchaType:h,type:n,blockSize:c,explain:f}=te(g),{proxy:p}=ne();let u=t(""),w=t(""),M=t(""),P=t(""),H=t(""),y=t(""),N=t(""),m=t(""),z=t(""),E=t(""),v=J({imgHeight:0,imgWidth:0,barHeight:0,barWidth:0}),C=t(void 0),I=t(void 0),$=t(void 0),B=t("#ddd"),O=t(void 0),V=t("icon-right"),j=t(!1),r=t(!1),d=t(!0),b=t(""),S=t(""),X=t(0);const D=re(()=>p.$el.querySelector(".verify-bar-area")),A=()=>{f.value===""?z.value=l("captcha.slide"):z.value=f.value,se(),ce(()=>{let{imgHeight:a,imgWidth:k,barHeight:W,barWidth:Z}=le(p);v.imgHeight=a,v.imgWidth=k,v.barHeight=W,v.barWidth=Z,p.$parent.$emit("ready",p)}),window.removeEventListener("touchmove",function(a){U(a)}),window.removeEventListener("mousemove",function(a){U(a)}),window.removeEventListener("touchend",function(){G()}),window.removeEventListener("mouseup",function(){G()}),window.addEventListener("touchmove",function(a){U(a)}),window.addEventListener("mousemove",function(a){U(a)}),window.addEventListener("touchend",function(){G()}),window.addEventListener("mouseup",function(){G()})};Ie(n,()=>{A()}),oe(()=>{A(),p.$el.onselectstart=function(){return!1}});const F=a=>{if((a=a||window.event).touches)k=a.touches[0].pageX;else var k=a.clientX;X.value=Math.floor(k-D.value.getBoundingClientRect().left),y.value=+new Date,r.value==0&&(z.value="",$.value="#337ab7",B.value="#337AB7",O.value="#fff",a.stopPropagation(),j.value=!0)},U=a=>{if(a=a||window.event,j.value&&r.value==0){if(a.touches)k=a.touches[0].pageX;else var k=a.clientX;var W=k-D.value.getBoundingClientRect().left;W>=D.value.offsetWidth-parseInt(parseInt(c.value.width)/2)-2&&(W=D.value.offsetWidth-parseInt(parseInt(c.value.width)/2)-2),W<=0&&(W=parseInt(parseInt(c.value.width)/2)),C.value=W-X.value+"px",I.value=W-X.value+"px"}},G=()=>{if(N.value=+new Date,j.value&&r.value==0){var a=parseInt((C.value||"0").replace("px",""));a=310*a/parseInt(v.imgWidth);let k={captchaType:h.value,pointJson:u.value?q(JSON.stringify({x:a,y:5}),u.value):JSON.stringify({x:a,y:5}),token:H.value};ue(k).then(W=>{if(W.repCode=="0000"){$.value="#5cb85c",B.value="#5cb85c",O.value="#fff",V.value="icon-check",d.value=!1,r.value=!0,o.value=="pop"&&setTimeout(()=>{p.$parent.clickShow=!1,Y()},1500),w.value=!0,m.value=`${((N.value-y.value)/1e3).toFixed(2)}s
            ${l("captcha.success")}`;var Z=u.value?q(H.value+"---"+JSON.stringify({x:a,y:5}),u.value):H.value+"---"+JSON.stringify({x:a,y:5});setTimeout(()=>{m.value="",p.$parent.closeBox(),p.$parent.$emit("success",{captchaVerification:Z})},1e3)}else $.value="#d9534f",B.value="#d9534f",O.value="#fff",V.value="icon-close",w.value=!1,setTimeout(function(){Y()},1e3),p.$parent.$emit("error",p),m.value=l("captcha.fail"),setTimeout(()=>{m.value=""},1e3)}),j.value=!1}},Y=async()=>{d.value=!0,E.value="",b.value="left .3s",C.value=0,I.value=void 0,S.value="width .3s",B.value="#ddd",$.value="#fff",O.value="#000",V.value="icon-right",r.value=!1,await se(),setTimeout(()=>{S.value="",b.value="",z.value=f.value},300)},se=async()=>{h.value;const a=await pe();a.repCode=="0000"?(M.value=a.repData.originalImageBase64,P.value=a.repData.jigsawImageBase64,H.value=a.repData.token,u.value=a.repData.secretKey):m.value=a.repMsg};return(a,k)=>(T(),_("div",he,[e(n)==="2"?(T(),_("div",{key:0,style:x({height:parseInt(e(v).imgHeight)+i.vSpace+"px"}),class:"verify-img-out"},[s("div",{style:x({width:e(v).imgWidth,height:e(v).imgHeight}),class:"verify-img-panel"},[s("img",{src:"data:image/png;base64,"+e(M),alt:"",style:{display:"block",width:"100%",height:"100%"}},null,8,de),ae(s("div",{class:"verify-refresh",onClick:Y},ge,512),[[ie,e(d)]]),$e(_e,{name:"tips"},{default:Oe(()=>[e(m)?(T(),_("span",{key:0,class:Q([e(w)?"suc-bg":"err-bg","verify-tips"])},L(e(m)),3)):K("",!0)]),_:1})],4)],4)):K("",!0),s("div",{style:x({width:e(v).imgWidth,height:i.barSize.height,"line-height":i.barSize.height}),class:"verify-bar-area"},[s("span",{class:"verify-msg",textContent:L(e(z))},null,8,fe),s("div",{style:x({width:e(I)!==void 0?e(I):i.barSize.height,height:i.barSize.height,"border-color":e(B),transaction:e(S)}),class:"verify-left-bar"},[s("span",{class:"verify-msg",textContent:L(e(E))},null,8,ye),s("div",{style:x({width:i.barSize.height,height:i.barSize.height,"background-color":e($),left:e(C),transition:e(b)}),class:"verify-move-block",onMousedown:F,onTouchstart:F},[s("i",{class:Q(["verify-icon iconfont",e(V)]),style:x({color:e(O)})},null,6),e(n)==="2"?(T(),_("div",{key:0,style:x({width:Math.floor(47*parseInt(e(v).imgWidth)/310)+"px",height:e(v).imgHeight,top:"-"+(parseInt(e(v).imgHeight)+i.vSpace)+"px","background-size":e(v).imgWidth+" "+e(v).imgHeight}),class:"verify-sub-block"},[s("img",{src:"data:image/png;base64,"+e(P),alt:"",style:{display:"block",width:"100%",height:"100%","-webkit-user-drag":"none"}},null,8,me)],4)):K("",!0)],36)],4)],4)]))}},Se={style:{position:"relative"}},xe={class:"verify-img-out"},we=[s("i",{class:"iconfont icon-refresh"},null,-1)],ze=["src"],ke={class:"verify-msg"},We={name:"Vue3Verify",components:{VerifySlide:be,VerifyPoints:{__name:"VerifyPoints",props:{mode:{type:String,default:"fixed"},captchaType:{type:String},vSpace:{type:Number,default:5},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},barSize:{type:Object,default:()=>({width:"310px",height:"40px"})}},setup(i){const g=i,{t:l}=ee(),{mode:o,captchaType:h}=te(g),{proxy:n}=ne();let c=t(""),f=t(3),p=J([]),u=J([]),w=t(1),M=t(""),P=J([]),H=t(""),y=J({imgHeight:0,imgWidth:0,barHeight:0,barWidth:0}),N=J([]),m=t(""),z=t(void 0),E=t(void 0),v=t(!0),C=t(!0);oe(()=>{p.splice(0,p.length),u.splice(0,u.length),w.value=1,V(),ce(()=>{let{imgHeight:r,imgWidth:d,barHeight:b,barWidth:S}=le(n);y.imgHeight=r,y.imgWidth=d,y.barHeight=b,y.barWidth=S,n.$parent.$emit("ready",n)}),n.$el.onselectstart=function(){return!1}});const I=t(null),$=function(r,d){return{x:d.offsetX,y:d.offsetY}},B=function(r){return N.push(Object.assign({},r)),w.value+1},O=async function(){N.splice(0,N.length),z.value="#000",E.value="#ddd",C.value=!0,p.splice(0,p.length),u.splice(0,u.length),w.value=1,await V(),v.value=!0},V=async()=>{h.value;const r=await pe();r.repCode=="0000"?(M.value=r.repData.originalImageBase64,H.value=r.repData.token,c.value=r.repData.secretKey,P.value=r.repData.wordList,m.value=l("captcha.point")+"\u3010"+P.value.join(",")+"\u3011"):m.value=r.repMsg},j=function(r,d){return r.map(b=>({x:Math.round(310*b.x/parseInt(d.imgWidth)),y:Math.round(155*b.y/parseInt(d.imgHeight))}))};return(r,d)=>(T(),_("div",Se,[s("div",xe,[s("div",{style:x({width:e(y).imgWidth,height:e(y).imgHeight,"background-size":e(y).imgWidth+" "+e(y).imgHeight,"margin-bottom":i.vSpace+"px"}),class:"verify-img-panel"},[ae(s("div",{class:"verify-refresh",style:{"z-index":"3"},onClick:O},we,512),[[ie,e(v)]]),s("img",{ref_key:"canvas",ref:I,src:"data:image/png;base64,"+e(M),alt:"",style:{display:"block",width:"100%",height:"100%"},onClick:d[0]||(d[0]=b=>e(C)?(S=>{if(u.push($(I,S)),w.value==f.value){w.value=B($(I,S));let X=j(u,y);u.length=0,u.push(...X),setTimeout(()=>{var D=c.value?q(H.value+"---"+JSON.stringify(u),c.value):H.value+"---"+JSON.stringify(u);let A={captchaType:h.value,pointJson:c.value?q(JSON.stringify(u),c.value):JSON.stringify(u),token:H.value};ue(A).then(F=>{F.repCode=="0000"?(z.value="#4cae4c",E.value="#5cb85c",m.value=l("captcha.success"),C.value=!1,o.value=="pop"&&setTimeout(()=>{n.$parent.clickShow=!1,O()},1500),n.$parent.$emit("success",{captchaVerification:D})):(n.$parent.$emit("error",n),z.value="#d9534f",E.value="#d9534f",m.value=l("captcha.fail"),setTimeout(()=>{O()},700))})},400)}w.value<f.value&&(w.value=B($(I,S)))})(b):void 0)},null,8,ze),(T(!0),_(Ce,null,Be(e(N),(b,S)=>(T(),_("div",{key:S,style:x({"background-color":"#1abd6c",color:"#fff","z-index":9999,width:"20px",height:"20px","text-align":"center","line-height":"20px","border-radius":"50%",position:"absolute",top:parseInt(b.y-10)+"px",left:parseInt(b.x-10)+"px"}),class:"point-area"},L(S+1),5))),128))],4)]),s("div",{style:x({width:e(y).imgWidth,color:e(z),"border-color":e(E),"line-height":i.barSize.height}),class:"verify-bar-area"},[s("span",ke,L(e(m)),1)],4)]))}}},props:{captchaType:{type:String,required:!0},figure:{type:Number},arith:{type:Number},mode:{type:String,default:"pop"},vSpace:{type:Number},explain:{type:String},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},blockSize:{type:Object},barSize:{type:Object}},setup(i){const{t:g}=ee(),{captchaType:l,mode:o}=te(i),h=t(!1),n=t(void 0),c=t(void 0),f=t({}),p=re(()=>o.value!="pop"||h.value);return Ne(()=>{switch(l.value){case"blockPuzzle":n.value="2",c.value="VerifySlide";break;case"clickWord":n.value="",c.value="VerifyPoints"}}),{t:g,clickShow:h,verifyType:n,componentType:c,instance:f,showBox:p,closeBox:()=>{h.value=!1,f.value.refresh&&f.value.refresh()},show:()=>{o.value=="pop"&&(h.value=!0)}}}},Te={key:0,class:"verifybox-top"},He=[s("i",{class:"iconfont icon-close"},null,-1)];ve=Le(We,[["render",function(i,g,l,o,h,n){return ae((T(),_("div",{class:Q(l.mode=="pop"?"mask":"")},[s("div",{class:Q(l.mode=="pop"?"verifybox":""),style:x({"max-width":parseInt(l.imgSize.width)+20+"px"})},[l.mode=="pop"?(T(),_("div",Te,[Ee(L(o.t("captcha.verification"))+" ",1),s("span",{class:"verifybox-close",onClick:g[0]||(g[0]=(...c)=>o.closeBox&&o.closeBox(...c))},He)])):K("",!0),s("div",{style:x({padding:l.mode=="pop"?"10px":"0"}),class:"verifybox-bottom"},[o.componentType?(T(),Ve(je(o.componentType),{key:0,ref:"instance",arith:l.arith,barSize:l.barSize,blockSize:l.blockSize,captchaType:l.captchaType,explain:l.explain,figure:l.figure,imgSize:l.imgSize,mode:l.mode,type:o.verifyType,vSpace:l.vSpace},null,8,["arith","barSize","blockSize","captchaType","explain","figure","imgSize","mode","type","vSpace"])):K("",!0)],4)],6)],2)),[[ie,o.showBox]])}]])});export{ve as _,Me as __tla};
