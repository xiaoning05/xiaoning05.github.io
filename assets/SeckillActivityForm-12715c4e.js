import{n as x,d as G,k as Z,r as c,o as A,c as z,b as _,e as i,a as o,h as g,w as H,q as O,j as Q,F as W,aq as $,ar as J,as as K,al as tt,B as at,bX as et,E as rt,v as lt,_ as ot,__tla as st}from"./index-aaa5adb3.js";import{_ as _t,__tla as ct}from"./Dialog-9a73a39c.js";import{_ as it,__tla as mt}from"./Form-93870143.js";import nt,{__tla as ut}from"./SpuSelect-80d29a4c.js";import pt,{__tla as ft}from"./SpuAndSkuList-1c8d773d.js";import{b as L,__tla as dt}from"./formatTime-9c0e8879.js";import{g as ht,__tla as yt}from"./seckillConfig-defa1b2f.js";import{r as m,__tla as vt}from"./formRules-d4770b7e.js";import{u as kt,__tla as bt}from"./useCrudSchemas-538534b3.js";import{g as wt,c as gt,u as Pt,__tla as Ct}from"./seckillActivity-230a0c44.js";import{b as St,__tla as It}from"./spu-d46eb782.js";import{g as Ft,__tla as Vt}from"./index-e75c9a63.js";import{u as Dt,__tla as Yt}from"./useMessage-873da1e2.js";import{__tla as Et}from"./Form.vue_vue_type_style_index_0_scoped_b283cb39_lang-2ebfd862.js";import{__tla as xt}from"./el-virtual-list-49b37423.js";import{__tla as At}from"./el-tree-select-49584d8b.js";import{__tla as Lt}from"./el-time-select-443b56b7.js";import{__tla as Mt}from"./InputPassword-7af61227.js";import{__tla as Ut}from"./Editor-71118346.js";import{__tla as Nt}from"./UploadImg-9fa46f1e.js";import{__tla as Rt}from"./index-93c914d7.js";import{__tla as Tt}from"./el-image-viewer-fc91515b.js";import{__tla as jt}from"./useUpload-c52dec87.js";import{__tla as qt}from"./index-fb6b5360.js";import{__tla as Xt}from"./UploadImgs-07b10914.js";import{__tla as Bt}from"./UploadImgs.vue_vue_type_style_index_0_scoped_9d666400_lang-4f9fa2ef.js";import{__tla as Gt}from"./UploadFile-31413487.js";import{__tla as Zt}from"./UploadFile.vue_vue_type_style_index_0_scoped_436eca1b_lang-d92f2323.js";import{__tla as zt}from"./tsxHelper-bb26e676.js";import{__tla as Ht}from"./ContentWrap-04d7f6d1.js";import{__tla as Ot}from"./index-5b7dcbf1.js";import{__tla as Qt}from"./index-b47c179c.js";import{__tla as Wt}from"./index-c602062a.js";import{__tla as $t}from"./el-image-1cd11263.js";import"./tree-02f455f9.js";import{__tla as Jt}from"./category-9fe58d90.js";import{__tla as Kt}from"./SkuList-8302ad2f.js";import{__tla as ta}from"./dict-f2796e71.js";import{__tla as aa}from"./DictTag-1c1088ae.js";import"./color-f5b6e279.js";let M,ea=Promise.all([(()=>{try{return st}catch{}})(),(()=>{try{return ct}catch{}})(),(()=>{try{return mt}catch{}})(),(()=>{try{return ut}catch{}})(),(()=>{try{return ft}catch{}})(),(()=>{try{return dt}catch{}})(),(()=>{try{return yt}catch{}})(),(()=>{try{return vt}catch{}})(),(()=>{try{return bt}catch{}})(),(()=>{try{return Ct}catch{}})(),(()=>{try{return It}catch{}})(),(()=>{try{return Vt}catch{}})(),(()=>{try{return Yt}catch{}})(),(()=>{try{return Et}catch{}})(),(()=>{try{return xt}catch{}})(),(()=>{try{return At}catch{}})(),(()=>{try{return Lt}catch{}})(),(()=>{try{return Mt}catch{}})(),(()=>{try{return Ut}catch{}})(),(()=>{try{return Nt}catch{}})(),(()=>{try{return Rt}catch{}})(),(()=>{try{return Tt}catch{}})(),(()=>{try{return jt}catch{}})(),(()=>{try{return qt}catch{}})(),(()=>{try{return Xt}catch{}})(),(()=>{try{return Bt}catch{}})(),(()=>{try{return Gt}catch{}})(),(()=>{try{return Zt}catch{}})(),(()=>{try{return zt}catch{}})(),(()=>{try{return Ht}catch{}})(),(()=>{try{return Ot}catch{}})(),(()=>{try{return Qt}catch{}})(),(()=>{try{return Wt}catch{}})(),(()=>{try{return $t}catch{}})(),(()=>{try{return Jt}catch{}})(),(()=>{try{return Kt}catch{}})(),(()=>{try{return ta}catch{}})(),(()=>{try{return aa}catch{}})()]).then(async()=>{let P,C,S;P=x({spuId:[m],name:[m],startTime:[m],endTime:[m],sort:[m],configIds:[m],totalLimitCount:[m],singleLimitCount:[m],totalStock:[m]}),C=x([{label:"\u79D2\u6740\u6D3B\u52A8\u540D\u79F0",field:"name",isSearch:!0,form:{colProps:{span:24}},table:{width:120}},{label:"\u6D3B\u52A8\u5F00\u59CB\u65F6\u95F4",field:"startTime",formatter:L,isSearch:!0,search:{component:"DatePicker",componentProps:{valueFormat:"YYYY-MM-DD",type:"daterange"}},form:{component:"DatePicker",componentProps:{type:"date",valueFormat:"x"}},table:{width:120}},{label:"\u6D3B\u52A8\u7ED3\u675F\u65F6\u95F4",field:"endTime",formatter:L,isSearch:!0,search:{component:"DatePicker",componentProps:{valueFormat:"YYYY-MM-DD",type:"daterange"}},form:{component:"DatePicker",componentProps:{type:"date",valueFormat:"x"}},table:{width:120}},{label:"\u79D2\u6740\u65F6\u6BB5",field:"configIds",form:{component:"Select",componentProps:{multiple:!0,optionsAlias:{labelField:"name",valueField:"id"}},api:ht},table:{width:300}},{label:"\u603B\u9650\u8D2D\u6570\u91CF",field:"totalLimitCount",form:{component:"InputNumber",value:0},table:{width:120}},{label:"\u5355\u6B21\u9650\u591F\u6570\u91CF",field:"singleLimitCount",form:{component:"InputNumber",value:0},table:{width:120}},{label:"\u6392\u5E8F",field:"sort",form:{component:"InputNumber",value:0},table:{width:80}},{label:"\u79D2\u6740\u6D3B\u52A8\u5546\u54C1",field:"spuId",isTable:!0,isSearch:!1,form:{colProps:{span:24}},table:{width:300}},{label:"\u5907\u6CE8",field:"remark",isSearch:!1,form:{component:"Input",componentProps:{type:"textarea",rows:4},colProps:{span:24}},table:{width:300}}]),{allSchemas:S}=kt(C),M=ot(G({name:"PromotionSeckillActivityForm",__name:"SeckillActivityForm",emits:["success"],setup(ra,{expose:U,emit:N}){const{t:b}=Z(),I=Dt(),f=c(!1),F=c(""),d=c(!1),V=c(""),n=c(),D=c(),Y=c(),R=[{name:"productConfig.stock",rule:a=>a>=1,message:"\u5546\u54C1\u79D2\u6740\u5E93\u5B58\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E 1 \uFF01\uFF01\uFF01"},{name:"productConfig.seckillPrice",rule:a=>a>=.01,message:"\u5546\u54C1\u79D2\u6740\u4EF7\u683C\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E 0.01 \uFF01\uFF01\uFF01"}],y=c([]),w=c([]),T=(a,t)=>{n.value.setValues({spuId:a}),E(a,t)},E=async(a,t,l)=>{var v;const s=[],u=await St([a]);if(u.length==0)return;y.value=[];const r=u[0],h=t===void 0?r==null?void 0:r.skus:(v=r==null?void 0:r.skus)==null?void 0:v.filter(e=>t.includes(e.id));h==null||h.forEach(e=>{let p={skuId:e.id,stock:0,seckillPrice:0};if(l!==void 0){const k=l.find(B=>B.skuId===e.id);k&&(k.seckillPrice=$(k.seckillPrice)),p=k||p}e.productConfig=p}),r.skus=h,s.push({spuId:r.id,spuDetail:r,propertyList:Ft(r)}),y.value.push(r),w.value=s};U({open:async(a,t)=>{var l;if(f.value=!0,F.value=b("action."+a),V.value=a,await X(),t){d.value=!0;try{const s=await wt(t);await E(s.spuId,(l=s.products)==null?void 0:l.map(u=>u.skuId),s.products),n.value.setValues(s)}finally{d.value=!1}}}});const j=N,q=async()=>{if(n&&await n.value.getElFormRef().validate()){d.value=!0;try{const a=J(Y.value.getSkuConfigs("productConfig"));a.forEach(l=>{l.seckillPrice=K(l.seckillPrice)});const t=n.value.formModel;t.products=a,V.value==="create"?(await gt(t),I.success(b("common.createSuccess"))):(await Pt(t),I.success(b("common.updateSuccess"))),f.value=!1,j("success")}finally{d.value=!1}}},X=async()=>{y.value=[],w.value=[],await tt(),n.value.getElFormRef().resetFields()};return(a,t)=>{const l=at,s=et,u=rt,r=it,h=_t,v=lt;return A(),z(W,null,[_(h,{modelValue:o(f),"onUpdate:modelValue":t[2]||(t[2]=e=>Q(f)?f.value=e:null),title:o(F),width:"65%"},{footer:i(()=>[_(l,{disabled:o(d),type:"primary",onClick:q},{default:i(()=>[g("\u786E \u5B9A")]),_:1},8,["disabled"]),_(l,{onClick:t[1]||(t[1]=e=>f.value=!1)},{default:i(()=>[g("\u53D6 \u6D88")]),_:1})]),default:i(()=>[H((A(),O(r,{ref_key:"formRef",ref:n,isCol:!0,rules:o(P),schema:o(S).formSchema},{spuId:i(()=>[_(l,{onClick:t[0]||(t[0]=e=>o(D).open())},{default:i(()=>[g("\u9009\u62E9\u5546\u54C1")]),_:1}),_(o(pt),{ref_key:"spuAndSkuListRef",ref:Y,"rule-config":R,"spu-list":o(y),"spu-property-list-p":o(w)},{default:i(()=>[_(u,{align:"center",label:"\u79D2\u6740\u5E93\u5B58","min-width":"168"},{default:i(({row:e})=>[_(s,{modelValue:e.productConfig.stock,"onUpdate:modelValue":p=>e.productConfig.stock=p,min:0,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),_(u,{align:"center",label:"\u79D2\u6740\u4EF7\u683C(\u5143)","min-width":"168"},{default:i(({row:e})=>[_(s,{modelValue:e.productConfig.seckillPrice,"onUpdate:modelValue":p=>e.productConfig.seckillPrice=p,min:0,precision:2,step:.1,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["spu-list","spu-property-list-p"])]),_:1},8,["rules","schema"])),[[v,o(d)]])]),_:1},8,["modelValue","title"]),_(o(nt),{ref_key:"spuSelectRef",ref:D,isSelectSku:!0,onConfirm:T},null,512)],64)}}}),[["__file","E:/newCode/GYZX-UI-ADMIN/src/views/mall/promotion/seckill/activity/SeckillActivityForm.vue"]])});export{ea as __tla,M as default};
