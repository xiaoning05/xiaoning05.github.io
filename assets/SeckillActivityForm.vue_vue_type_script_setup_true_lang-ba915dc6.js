import{n as L,d as G,k as H,r as c,o as T,c as J,b as i,e as n,a as r,h as w,w as K,q as O,j as Q,F as W,ap as X,aq as Z,ar as $,ak as ee,A as te,bU as ae,E as le,v as se,__tla as re}from"./index-34f06ebd.js";import{_ as oe,__tla as ie}from"./Dialog.vue_vue_type_style_index_0_lang-08560286.js";import{_ as ce,__tla as ne}from"./Form-980450b6.js";import{_ as ue,__tla as me}from"./SpuSelect.vue_vue_type_script_setup_true_lang-940096c8.js";import{_ as pe,__tla as de}from"./SpuAndSkuList.vue_vue_type_script_setup_true_lang-b594eae0.js";import{b as U,__tla as _e}from"./formatTime-ed0a77fd.js";import{g as fe,__tla as he}from"./seckillConfig-60aecae5.js";import{r as u,__tla as ke}from"./formRules-ecd4de8b.js";import{u as ve,__tla as ye}from"./useCrudSchemas-8bd8b360.js";import{g as be,c as ge,u as we,__tla as Pe}from"./seckillActivity-274c2c59.js";import{b as Ce,__tla as Se}from"./spu-7528f5a7.js";import{g as Ie,__tla as Ve}from"./index-04c10e0e.js";import{u as Fe,__tla as De}from"./useMessage-7a5ab7ef.js";let x,Ye=Promise.all([(()=>{try{return re}catch{}})(),(()=>{try{return ie}catch{}})(),(()=>{try{return ne}catch{}})(),(()=>{try{return me}catch{}})(),(()=>{try{return de}catch{}})(),(()=>{try{return _e}catch{}})(),(()=>{try{return he}catch{}})(),(()=>{try{return ke}catch{}})(),(()=>{try{return ye}catch{}})(),(()=>{try{return Pe}catch{}})(),(()=>{try{return Se}catch{}})(),(()=>{try{return Ve}catch{}})(),(()=>{try{return De}catch{}})()]).then(async()=>{let P,C,S;P=L({spuId:[u],name:[u],startTime:[u],endTime:[u],sort:[u],configIds:[u],totalLimitCount:[u],singleLimitCount:[u],totalStock:[u]}),C=L([{label:"\u79D2\u6740\u6D3B\u52A8\u540D\u79F0",field:"name",isSearch:!0,form:{colProps:{span:24}},table:{width:120}},{label:"\u6D3B\u52A8\u5F00\u59CB\u65F6\u95F4",field:"startTime",formatter:U,isSearch:!0,search:{component:"DatePicker",componentProps:{valueFormat:"YYYY-MM-DD",type:"daterange"}},form:{component:"DatePicker",componentProps:{type:"date",valueFormat:"x"}},table:{width:120}},{label:"\u6D3B\u52A8\u7ED3\u675F\u65F6\u95F4",field:"endTime",formatter:U,isSearch:!0,search:{component:"DatePicker",componentProps:{valueFormat:"YYYY-MM-DD",type:"daterange"}},form:{component:"DatePicker",componentProps:{type:"date",valueFormat:"x"}},table:{width:120}},{label:"\u79D2\u6740\u65F6\u6BB5",field:"configIds",form:{component:"Select",componentProps:{multiple:!0,optionsAlias:{labelField:"name",valueField:"id"}},api:fe},table:{width:300}},{label:"\u603B\u9650\u8D2D\u6570\u91CF",field:"totalLimitCount",form:{component:"InputNumber",value:0},table:{width:120}},{label:"\u5355\u6B21\u9650\u591F\u6570\u91CF",field:"singleLimitCount",form:{component:"InputNumber",value:0},table:{width:120}},{label:"\u6392\u5E8F",field:"sort",form:{component:"InputNumber",value:0},table:{width:80}},{label:"\u79D2\u6740\u6D3B\u52A8\u5546\u54C1",field:"spuId",isTable:!0,isSearch:!1,form:{colProps:{span:24}},table:{width:300}},{label:"\u5907\u6CE8",field:"remark",isSearch:!1,form:{component:"Input",componentProps:{type:"textarea",rows:4},colProps:{span:24}},table:{width:300}}]),{allSchemas:S}=ve(C),x=G({name:"PromotionSeckillActivityForm",__name:"SeckillActivityForm",emits:["success"],setup(Ee,{expose:A,emit:M}){const{t:b}=H(),I=Fe(),_=c(!1),V=c(""),f=c(!1),F=c(""),m=c(),D=c(),Y=c(),R=[{name:"productConfig.stock",rule:t=>t>=1,message:"\u5546\u54C1\u79D2\u6740\u5E93\u5B58\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E 1 \uFF01\uFF01\uFF01"},{name:"productConfig.seckillPrice",rule:t=>t>=.01,message:"\u5546\u54C1\u79D2\u6740\u4EF7\u683C\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E 0.01 \uFF01\uFF01\uFF01"}],k=c([]),g=c([]),N=(t,e)=>{m.value.setValues({spuId:t}),E(t,e)},E=async(t,e,s)=>{var v;const o=[],p=await Ce([t]);if(p.length==0)return;k.value=[];const l=p[0],h=e===void 0?l==null?void 0:l.skus:(v=l==null?void 0:l.skus)==null?void 0:v.filter(a=>e.includes(a.id));h==null||h.forEach(a=>{let d={skuId:a.id,stock:0,seckillPrice:0};if(s!==void 0){const y=s.find(B=>B.skuId===a.id);y&&(y.seckillPrice=X(y.seckillPrice)),d=y||d}a.productConfig=d}),l.skus=h,o.push({spuId:l.id,spuDetail:l,propertyList:Ie(l)}),k.value.push(l),g.value=o};A({open:async(t,e)=>{var s;if(_.value=!0,V.value=b("action."+t),F.value=t,await z(),e){f.value=!0;try{const o=await be(e);await E(o.spuId,(s=o.products)==null?void 0:s.map(p=>p.skuId),o.products),m.value.setValues(o)}finally{f.value=!1}}}});const q=M,j=async()=>{if(m&&await m.value.getElFormRef().validate()){f.value=!0;try{const t=Z(Y.value.getSkuConfigs("productConfig"));t.forEach(s=>{s.seckillPrice=$(s.seckillPrice)});const e=m.value.formModel;e.products=t,F.value==="create"?(await ge(e),I.success(b("common.createSuccess"))):(await we(e),I.success(b("common.updateSuccess"))),_.value=!1,q("success")}finally{f.value=!1}}},z=async()=>{k.value=[],g.value=[],await ee(),m.value.getElFormRef().resetFields()};return(t,e)=>{const s=te,o=ae,p=le,l=ce,h=oe,v=se;return T(),J(W,null,[i(h,{modelValue:r(_),"onUpdate:modelValue":e[2]||(e[2]=a=>Q(_)?_.value=a:null),title:r(V),width:"65%"},{footer:n(()=>[i(s,{disabled:r(f),type:"primary",onClick:j},{default:n(()=>[w("\u786E \u5B9A")]),_:1},8,["disabled"]),i(s,{onClick:e[1]||(e[1]=a=>_.value=!1)},{default:n(()=>[w("\u53D6 \u6D88")]),_:1})]),default:n(()=>[K((T(),O(l,{ref_key:"formRef",ref:m,isCol:!0,rules:r(P),schema:r(S).formSchema},{spuId:n(()=>[i(s,{onClick:e[0]||(e[0]=a=>r(D).open())},{default:n(()=>[w("\u9009\u62E9\u5546\u54C1")]),_:1}),i(r(pe),{ref_key:"spuAndSkuListRef",ref:Y,"rule-config":R,"spu-list":r(k),"spu-property-list-p":r(g)},{default:n(()=>[i(p,{align:"center",label:"\u79D2\u6740\u5E93\u5B58","min-width":"168"},{default:n(({row:a})=>[i(o,{modelValue:a.productConfig.stock,"onUpdate:modelValue":d=>a.productConfig.stock=d,min:0,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(p,{align:"center",label:"\u79D2\u6740\u4EF7\u683C(\u5143)","min-width":"168"},{default:n(({row:a})=>[i(o,{modelValue:a.productConfig.seckillPrice,"onUpdate:modelValue":d=>a.productConfig.seckillPrice=d,min:0,precision:2,step:.1,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["spu-list","spu-property-list-p"])]),_:1},8,["rules","schema"])),[[v,r(f)]])]),_:1},8,["modelValue","title"]),i(r(ue),{ref_key:"spuSelectRef",ref:D,isSelectSku:!0,onConfirm:N},null,512)],64)}}})});export{x as _,Ye as __tla};
