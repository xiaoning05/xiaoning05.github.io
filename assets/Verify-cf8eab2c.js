import{k as ee,bQ as te,ai as ne,r as t,n as M,X as re,aQ as Ie,p as oe,o as T,c as _,a as e,at as S,f as s,w as ae,Z as ie,b as $e,e as Oe,M as G,t as V,$ as R,N as _e,ak as ce,dl as ue,dm as pe,F as Ce,g as Ne,b3 as Be,h as Ee,q as je,aO as De,__tla as Je}from"./index-34f06ebd.js";import{C as q,__tla as Me}from"./index-176464f7.js";import{_ as Ve}from"./_plugin-vue_export-helper-1b428a4d.js";let ve,Le=Promise.all([(()=>{try{return Je}catch{}})(),(()=>{try{return Me}catch{}})()]).then(async()=>{function A(i,g="XwKsGlMcdPMEhR1B"){const l=q.enc.Utf8.parse(g),o=q.enc.Utf8.parse(i);return q.AES.encrypt(o,l,{mode:q.mode.ECB,padding:q.pad.Pkcs7}).toString()}function le(i){let g,l,o,h;const n=window,c=i.$el.parentNode.offsetWidth||n.offsetWidth,f=i.$el.parentNode.offsetHeight||n.offsetHeight;return g=i.imgSize.width.indexOf("%")!=-1?parseInt(i.imgSize.width)/100*c+"px":i.imgSize.width,l=i.imgSize.height.indexOf("%")!=-1?parseInt(i.imgSize.height)/100*f+"px":i.imgSize.height,o=i.barSize.width.indexOf("%")!=-1?parseInt(i.barSize.width)/100*c+"px":i.barSize.width,h=i.barSize.height.indexOf("%")!=-1?parseInt(i.barSize.height)/100*f+"px":i.barSize.height,{imgWidth:g,imgHeight:l,barWidth:o,barHeight:h}}const he={style:{position:"relative"}},de=["src"],ge=[s("i",{class:"iconfont icon-refresh"},null,-1)],fe=["textContent"],ye=["textContent"],me=["src"],be={__name:"VerifySlide",props:{captchaType:{type:String},type:{type:String,default:"1"},mode:{type:String,default:"fixed"},vSpace:{type:Number,default:5},explain:{type:String,default:""},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},blockSize:{type:Object,default:()=>({width:"50px",height:"50px"})},barSize:{type:Object,default:()=>({width:"310px",height:"30px"})}},setup(i){const g=i,{t:l}=ee(),{mode:o,captchaType:h,type:n,blockSize:c,explain:f}=te(g),{proxy:p}=ne();let u=t(""),w=t(""),L=t(""),P=t(""),H=t(""),y=t(""),B=t(""),m=t(""),z=t(""),E=t(""),v=M({imgHeight:0,imgWidth:0,barHeight:0,barWidth:0}),C=t(void 0),I=t(void 0),$=t(void 0),N=t("#ddd"),O=t(void 0),j=t("icon-right"),D=t(!1),r=t(!1),d=t(!0),b=t(""),x=t(""),X=t(0);const J=re(()=>p.$el.querySelector(".verify-bar-area")),F=()=>{f.value===""?z.value=l("captcha.slide"):z.value=f.value,se(),ce(()=>{let{imgHeight:a,imgWidth:k,barHeight:W,barWidth:Z}=le(p);v.imgHeight=a,v.imgWidth=k,v.barHeight=W,v.barWidth=Z,p.$parent.$emit("ready",p)}),window.removeEventListener("touchmove",function(a){Q(a)}),window.removeEventListener("mousemove",function(a){Q(a)}),window.removeEventListener("touchend",function(){U()}),window.removeEventListener("mouseup",function(){U()}),window.addEventListener("touchmove",function(a){Q(a)}),window.addEventListener("mousemove",function(a){Q(a)}),window.addEventListener("touchend",function(){U()}),window.addEventListener("mouseup",function(){U()})};Ie(n,()=>{F()}),oe(()=>{F(),p.$el.onselectstart=function(){return!1}});const K=a=>{if((a=a||window.event).touches)k=a.touches[0].pageX;else var k=a.clientX;X.value=Math.floor(k-J.value.getBoundingClientRect().left),y.value=+new Date,r.value==0&&(z.value="",$.value="#337ab7",N.value="#337AB7",O.value="#fff",a.stopPropagation(),D.value=!0)},Q=a=>{if(a=a||window.event,D.value&&r.value==0){if(a.touches)k=a.touches[0].pageX;else var k=a.clientX;var W=k-J.value.getBoundingClientRect().left;W>=J.value.offsetWidth-parseInt(parseInt(c.value.width)/2)-2&&(W=J.value.offsetWidth-parseInt(parseInt(c.value.width)/2)-2),W<=0&&(W=parseInt(parseInt(c.value.width)/2)),C.value=W-X.value+"px",I.value=W-X.value+"px"}},U=()=>{if(B.value=+new Date,D.value&&r.value==0){var a=parseInt((C.value||"0").replace("px",""));a=310*a/parseInt(v.imgWidth);let k={captchaType:h.value,pointJson:u.value?A(JSON.stringify({x:a,y:5}),u.value):JSON.stringify({x:a,y:5}),token:H.value};ue(k).then(W=>{if(W.repCode=="0000"){$.value="#5cb85c",N.value="#5cb85c",O.value="#fff",j.value="icon-check",d.value=!1,r.value=!0,o.value=="pop"&&setTimeout(()=>{p.$parent.clickShow=!1,Y()},1500),w.value=!0,m.value=`${((B.value-y.value)/1e3).toFixed(2)}s
            ${l("captcha.success")}`;var Z=u.value?A(H.value+"---"+JSON.stringify({x:a,y:5}),u.value):H.value+"---"+JSON.stringify({x:a,y:5});setTimeout(()=>{m.value="",p.$parent.closeBox(),p.$parent.$emit("success",{captchaVerification:Z})},1e3)}else $.value="#d9534f",N.value="#d9534f",O.value="#fff",j.value="icon-close",w.value=!1,setTimeout(function(){Y()},1e3),p.$parent.$emit("error",p),m.value=l("captcha.fail"),setTimeout(()=>{m.value=""},1e3)}),D.value=!1}},Y=async()=>{d.value=!0,E.value="",b.value="left .3s",C.value=0,I.value=void 0,x.value="width .3s",N.value="#ddd",$.value="#fff",O.value="#000",j.value="icon-right",r.value=!1,await se(),setTimeout(()=>{x.value="",b.value="",z.value=f.value},300)},se=async()=>{h.value;const a=await pe();a.repCode=="0000"?(L.value=a.repData.originalImageBase64,P.value=a.repData.jigsawImageBase64,H.value=a.repData.token,u.value=a.repData.secretKey):m.value=a.repMsg};return(a,k)=>(T(),_("div",he,[e(n)==="2"?(T(),_("div",{key:0,style:S({height:parseInt(e(v).imgHeight)+i.vSpace+"px"}),class:"verify-img-out"},[s("div",{style:S({width:e(v).imgWidth,height:e(v).imgHeight}),class:"verify-img-panel"},[s("img",{src:"data:image/png;base64,"+e(L),alt:"",style:{display:"block",width:"100%",height:"100%"}},null,8,de),ae(s("div",{class:"verify-refresh",onClick:Y},ge,512),[[ie,e(d)]]),$e(_e,{name:"tips"},{default:Oe(()=>[e(m)?(T(),_("span",{key:0,class:G([e(w)?"suc-bg":"err-bg","verify-tips"])},V(e(m)),3)):R("",!0)]),_:1})],4)],4)):R("",!0),s("div",{style:S({width:e(v).imgWidth,height:i.barSize.height,"line-height":i.barSize.height}),class:"verify-bar-area"},[s("span",{class:"verify-msg",textContent:V(e(z))},null,8,fe),s("div",{style:S({width:e(I)!==void 0?e(I):i.barSize.height,height:i.barSize.height,"border-color":e(N),transaction:e(x)}),class:"verify-left-bar"},[s("span",{class:"verify-msg",textContent:V(e(E))},null,8,ye),s("div",{style:S({width:i.barSize.height,height:i.barSize.height,"background-color":e($),left:e(C),transition:e(b)}),class:"verify-move-block",onMousedown:K,onTouchstart:K},[s("i",{class:G(["verify-icon iconfont",e(j)]),style:S({color:e(O)})},null,6),e(n)==="2"?(T(),_("div",{key:0,style:S({width:Math.floor(47*parseInt(e(v).imgWidth)/310)+"px",height:e(v).imgHeight,top:"-"+(parseInt(e(v).imgHeight)+i.vSpace)+"px","background-size":e(v).imgWidth+" "+e(v).imgHeight}),class:"verify-sub-block"},[s("img",{src:"data:image/png;base64,"+e(P),alt:"",style:{display:"block",width:"100%",height:"100%","-webkit-user-drag":"none"}},null,8,me)],4)):R("",!0)],36)],4)],4)]))}},xe={style:{position:"relative"}},Se={class:"verify-img-out"},we=[s("i",{class:"iconfont icon-refresh"},null,-1)],ze=["src"],ke={class:"verify-msg"},We={name:"Vue3Verify",components:{VerifySlide:be,VerifyPoints:{__name:"VerifyPoints",props:{mode:{type:String,default:"fixed"},captchaType:{type:String},vSpace:{type:Number,default:5},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},barSize:{type:Object,default:()=>({width:"310px",height:"40px"})}},setup(i){const g=i,{t:l}=ee(),{mode:o,captchaType:h}=te(g),{proxy:n}=ne();let c=t(""),f=t(3),p=M([]),u=M([]),w=t(1),L=t(""),P=M([]),H=t(""),y=M({imgHeight:0,imgWidth:0,barHeight:0,barWidth:0}),B=M([]),m=t(""),z=t(void 0),E=t(void 0),v=t(!0),C=t(!0);oe(()=>{p.splice(0,p.length),u.splice(0,u.length),w.value=1,j(),ce(()=>{let{imgHeight:r,imgWidth:d,barHeight:b,barWidth:x}=le(n);y.imgHeight=r,y.imgWidth=d,y.barHeight=b,y.barWidth=x,n.$parent.$emit("ready",n)}),n.$el.onselectstart=function(){return!1}});const I=t(null),$=function(r,d){return{x:d.offsetX,y:d.offsetY}},N=function(r){return B.push(Object.assign({},r)),w.value+1},O=async function(){B.splice(0,B.length),z.value="#000",E.value="#ddd",C.value=!0,p.splice(0,p.length),u.splice(0,u.length),w.value=1,await j(),v.value=!0},j=async()=>{h.value;const r=await pe();r.repCode=="0000"?(L.value=r.repData.originalImageBase64,H.value=r.repData.token,c.value=r.repData.secretKey,P.value=r.repData.wordList,m.value=l("captcha.point")+"\u3010"+P.value.join(",")+"\u3011"):m.value=r.repMsg},D=function(r,d){return r.map(b=>({x:Math.round(310*b.x/parseInt(d.imgWidth)),y:Math.round(155*b.y/parseInt(d.imgHeight))}))};return(r,d)=>(T(),_("div",xe,[s("div",Se,[s("div",{style:S({width:e(y).imgWidth,height:e(y).imgHeight,"background-size":e(y).imgWidth+" "+e(y).imgHeight,"margin-bottom":i.vSpace+"px"}),class:"verify-img-panel"},[ae(s("div",{class:"verify-refresh",style:{"z-index":"3"},onClick:O},we,512),[[ie,e(v)]]),s("img",{ref_key:"canvas",ref:I,src:"data:image/png;base64,"+e(L),alt:"",style:{display:"block",width:"100%",height:"100%"},onClick:d[0]||(d[0]=b=>e(C)?(x=>{if(u.push($(I,x)),w.value==f.value){w.value=N($(I,x));let X=D(u,y);u.length=0,u.push(...X),setTimeout(()=>{var J=c.value?A(H.value+"---"+JSON.stringify(u),c.value):H.value+"---"+JSON.stringify(u);let F={captchaType:h.value,pointJson:c.value?A(JSON.stringify(u),c.value):JSON.stringify(u),token:H.value};ue(F).then(K=>{K.repCode=="0000"?(z.value="#4cae4c",E.value="#5cb85c",m.value=l("captcha.success"),C.value=!1,o.value=="pop"&&setTimeout(()=>{n.$parent.clickShow=!1,O()},1500),n.$parent.$emit("success",{captchaVerification:J})):(n.$parent.$emit("error",n),z.value="#d9534f",E.value="#d9534f",m.value=l("captcha.fail"),setTimeout(()=>{O()},700))})},400)}w.value<f.value&&(w.value=N($(I,x)))})(b):void 0)},null,8,ze),(T(!0),_(Ce,null,Ne(e(B),(b,x)=>(T(),_("div",{key:x,style:S({"background-color":"#1abd6c",color:"#fff","z-index":9999,width:"20px",height:"20px","text-align":"center","line-height":"20px","border-radius":"50%",position:"absolute",top:parseInt(b.y-10)+"px",left:parseInt(b.x-10)+"px"}),class:"point-area"},V(x+1),5))),128))],4)]),s("div",{style:S({width:e(y).imgWidth,color:e(z),"border-color":e(E),"line-height":i.barSize.height}),class:"verify-bar-area"},[s("span",ke,V(e(m)),1)],4)]))}}},props:{captchaType:{type:String,required:!0},figure:{type:Number},arith:{type:Number},mode:{type:String,default:"pop"},vSpace:{type:Number},explain:{type:String},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},blockSize:{type:Object},barSize:{type:Object}},setup(i){const{t:g}=ee(),{captchaType:l,mode:o}=te(i),h=t(!1),n=t(void 0),c=t(void 0),f=t({}),p=re(()=>o.value!="pop"||h.value);return Be(()=>{switch(l.value){case"blockPuzzle":n.value="2",c.value="VerifySlide";break;case"clickWord":n.value="",c.value="VerifyPoints"}}),{t:g,clickShow:h,verifyType:n,componentType:c,instance:f,showBox:p,closeBox:()=>{h.value=!1,f.value.refresh&&f.value.refresh()},show:()=>{o.value=="pop"&&(h.value=!0)}}}},Te={key:0,class:"verifybox-top"},He=[s("i",{class:"iconfont icon-close"},null,-1)];ve=Ve(We,[["render",function(i,g,l,o,h,n){return ae((T(),_("div",{class:G(l.mode=="pop"?"mask":"")},[s("div",{class:G(l.mode=="pop"?"verifybox":""),style:S({"max-width":parseInt(l.imgSize.width)+20+"px"})},[l.mode=="pop"?(T(),_("div",Te,[Ee(V(o.t("captcha.verification"))+" ",1),s("span",{class:"verifybox-close",onClick:g[0]||(g[0]=(...c)=>o.closeBox&&o.closeBox(...c))},He)])):R("",!0),s("div",{style:S({padding:l.mode=="pop"?"10px":"0"}),class:"verifybox-bottom"},[o.componentType?(T(),je(De(o.componentType),{key:0,ref:"instance",arith:l.arith,barSize:l.barSize,blockSize:l.blockSize,captchaType:l.captchaType,explain:l.explain,figure:l.figure,imgSize:l.imgSize,mode:l.mode,type:o.verifyType,vSpace:l.vSpace},null,8,["arith","barSize","blockSize","captchaType","explain","figure","imgSize","mode","type","vSpace"])):R("",!0)],4)],6)],2)),[[ie,o.showBox]])}]])});export{ve as _,Le as __tla};
