import{d as na,D as _a,aj as ia,ak as ca,r as s,n as ua,p as ma,S as fa,o as d,q as C,e as r,c as X,g as pa,w as Y,a,f as F,t as T,b as t,h as f,a0 as V,F as da,al as ya,am as ha,an as va,y as ka,ai as ga,L as ba,C as Ca,A as wa,B as xa,a9 as Ta,v as Ua,_ as Da,__tla as Va}from"./index-b079f499.js";import{_ as Sa,__tla as Aa}from"./ContentWrap-0fab5b86.js";import{b as Ea}from"./formCreate-a3356cdc.js";import{a as Fa,__tla as Ba}from"./index-3847a6fa.js";import{g as Ia,__tla as qa}from"./index-e2f22c48.js";import{a as Pa,r as Ra,g as ja,__tla as za}from"./index-ec9d7ed0.js";import Na,{__tla as Za}from"./TaskUpdateAssigneeForm-c8afece4.js";import $a,{__tla as Ga}from"./ProcessInstanceBpmnViewer-ea81e88e.js";import Ka,{__tla as La}from"./ProcessInstanceTaskList-7052aa4e.js";import Ma,{__tla as Oa}from"./TaskReturnDialogForm-2bb9142c.js";import Wa,{__tla as Xa}from"./TaskDelegateForm-1ec074dd.js";import Ya,{__tla as Ha}from"./TaskAddSignDialogForm-ba5d5f7c.js";import{u as Ja,__tla as Qa}from"./useMessage-66b9cf03.js";import{E as ae,__tla as ee}from"./index-3be78f60.js";import{__tla as te}from"./Dialog-07bcd661.js";import{__tla as re}from"./index-41e17afa.js";import{__tla as le}from"./bpmn-embedded-37f9a71a.js";import{__tla as se}from"./XTextButton-8553715f.js";import{__tla as oe}from"./XButton-e75a6501.js";import{__tla as ne}from"./el-collapse-item-4f8d56ef.js";import{__tla as _e}from"./el-link-ed8d35b1.js";import{__tla as ie}from"./el-drawer-05b2f2da.js";import{__tla as ce}from"./dict-2c56908b.js";import{__tla as ue}from"./formatTime-0805635f.js";import{__tla as me}from"./el-timeline-item-e33275c7.js";import{__tla as fe}from"./DictTag-6d4c3489.js";import"./color-f5b6e279.js";import{__tla as pe}from"./ProcessInstanceChildrenTaskList-d460a3a3.js";import{__tla as de}from"./TaskSubSignDialogForm-cab0c4db.js";let H,ye=Promise.all([(()=>{try{return Va}catch{}})(),(()=>{try{return Aa}catch{}})(),(()=>{try{return Ba}catch{}})(),(()=>{try{return qa}catch{}})(),(()=>{try{return za}catch{}})(),(()=>{try{return Za}catch{}})(),(()=>{try{return Ga}catch{}})(),(()=>{try{return La}catch{}})(),(()=>{try{return Oa}catch{}})(),(()=>{try{return Xa}catch{}})(),(()=>{try{return Ha}catch{}})(),(()=>{try{return Qa}catch{}})(),(()=>{try{return ee}catch{}})(),(()=>{try{return te}catch{}})(),(()=>{try{return re}catch{}})(),(()=>{try{return le}catch{}})(),(()=>{try{return se}catch{}})(),(()=>{try{return oe}catch{}})(),(()=>{try{return ne}catch{}})(),(()=>{try{return _e}catch{}})(),(()=>{try{return ie}catch{}})(),(()=>{try{return ce}catch{}})(),(()=>{try{return ue}catch{}})(),(()=>{try{return me}catch{}})(),(()=>{try{return fe}catch{}})(),(()=>{try{return pe}catch{}})(),(()=>{try{return de}catch{}})()]).then(async()=>{let B,I,q,P,R;B={class:"el-icon-picture-outline"},I={style:{"margin-bottom":"20px","margin-left":"10%","font-size":"14px"}},q={class:"el-icon-document"},P={key:1},R=na({name:"BpmProcessInstanceDetail",__name:"index",setup(he){const{query:J}=_a(),S=Ja(),{proxy:Q}=ia(),aa=ca().getUser.id,A=J.id,w=s(!1),o=s({}),j=s(""),E=s(!0),v=s([]),U=s([]),k=s([]),ea=ua({reason:[{required:!0,message:"\u5BA1\u6279\u5EFA\u8BAE\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),D=s(),x=s({rule:[],option:{},value:{}}),z=async(n,e)=>{const l=U.value.indexOf(n),b=Q.$refs["form"+l][0],y=a(b);if(!y||!await y.validate())return;const h={id:n.id,reason:k.value[l].reason};e?(await Pa(h),S.success("\u5BA1\u6279\u901A\u8FC7\u6210\u529F")):(await Ra(h),S.success("\u5BA1\u6279\u4E0D\u901A\u8FC7\u6210\u529F")),g()},N=s(),Z=s(),$=s(),G=s(),g=()=>{ta(),ra()},K=s(null),ta=async()=>{try{w.value=!0;const n=await Ia(A);if(!n)return void S.error("\u67E5\u8BE2\u4E0D\u5230\u6D41\u7A0B\u4FE1\u606F\uFF01");o.value=n;const e=n.processDefinition;e.formType===10?(Ea(x,e.formConf,e.formFields,n.formVariables),ya().then(()=>{var l,b,y,h,u,m;(b=(l=D.value)==null?void 0:l.fapi)==null||b.btn.show(!1),(h=(y=D.value)==null?void 0:y.fapi)==null||h.resetBtn.show(!1),(m=(u=D.value)==null?void 0:u.fapi)==null||m.disabled(!0)})):K.value=ha(n.processDefinition.formCustomViewPath),j.value=await Fa(e.id)}finally{w.value=!1}},ra=async()=>{try{E.value=!0;const n=await ja(A);v.value=[],n.forEach(e=>{e.result!==4&&v.value.push(e)}),v.value.sort((e,l)=>e.endTime&&l.endTime?l.endTime-e.endTime:e.endTime?1:l.endTime?-1:l.createTime-e.createTime),U.value=[],k.value=[],L(v.value)}finally{E.value=!1}},L=n=>{n.forEach(e=>{va(e.children)||L(e.children),e.result!==1&&e.result!==6||e.assigneeUser&&e.assigneeUser.id===aa&&(U.value.push({...e}),k.value.push({reason:""}))})};return ma(()=>{g()}),(n,e)=>{const l=ka,b=ga,y=ba,h=Ca,u=wa,m=xa,M=Ta,O=ae,la=fa("form-create"),sa=Sa,W=Ua;return d(),C(sa,null,{default:r(()=>[(d(!0),X(da,null,pa(a(U),(i,p)=>Y((d(),C(O,{key:p,class:"box-card"},{header:r(()=>[F("span",B,"\u5BA1\u6279\u4EFB\u52A1\u3010"+T(i.name)+"\u3011",1)]),default:r(()=>[t(M,{offset:6,span:16},{default:r(()=>[t(h,{ref_for:!0,ref:"form"+p,model:a(k)[p],rules:a(ea),"label-width":"100px"},{default:r(()=>[a(o)&&a(o).name?(d(),C(l,{key:0,label:"\u6D41\u7A0B\u540D"},{default:r(()=>[f(T(a(o).name),1)]),_:1})):V("",!0),a(o)&&a(o).startUser?(d(),C(l,{key:1,label:"\u6D41\u7A0B\u53D1\u8D77\u4EBA"},{default:r(()=>[f(T(a(o).startUser.nickname)+" ",1),t(b,{size:"small",type:"info"},{default:r(()=>[f(T(a(o).startUser.deptName),1)]),_:1})]),_:1})):V("",!0),t(l,{label:"\u5BA1\u6279\u5EFA\u8BAE",prop:"reason"},{default:r(()=>[t(y,{modelValue:a(k)[p].reason,"onUpdate:modelValue":c=>a(k)[p].reason=c,placeholder:"\u8BF7\u8F93\u5165\u5BA1\u6279\u5EFA\u8BAE",type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["model","rules"]),F("div",I,[t(m,{type:"success",onClick:c=>z(i,!0)},{default:r(()=>[t(u,{icon:"ep:select"}),f(" \u901A\u8FC7 ")]),_:2},1032,["onClick"]),t(m,{type:"danger",onClick:c=>z(i,!1)},{default:r(()=>[t(u,{icon:"ep:close"}),f(" \u4E0D\u901A\u8FC7 ")]),_:2},1032,["onClick"]),t(m,{type:"primary",onClick:c=>{return _=i.id,void N.value.open(_);var _}},{default:r(()=>[t(u,{icon:"ep:edit"}),f(" \u8F6C\u529E ")]),_:2},1032,["onClick"]),t(m,{type:"primary",onClick:c=>(async _=>{Z.value.open(_.id)})(i)},{default:r(()=>[t(u,{icon:"ep:position"}),f(" \u59D4\u6D3E ")]),_:2},1032,["onClick"]),t(m,{type:"primary",onClick:c=>(async _=>{G.value.open(_.id)})(i)},{default:r(()=>[t(u,{icon:"ep:plus"}),f(" \u52A0\u7B7E ")]),_:2},1032,["onClick"]),t(m,{type:"warning",onClick:c=>(async _=>{$.value.open(_.id)})(i)},{default:r(()=>[t(u,{icon:"ep:back"}),f(" \u56DE\u9000 ")]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024)),[[W,a(w)]])),128)),Y((d(),C(O,{class:"box-card"},{header:r(()=>[F("span",q,"\u7533\u8BF7\u4FE1\u606F\u3010"+T(a(o).name)+"\u3011",1)]),default:r(()=>{var i,p,c,_;return[((p=(i=a(o))==null?void 0:i.processDefinition)==null?void 0:p.formType)===10?(d(),C(M,{key:0,offset:6,span:16},{default:r(()=>[t(la,{ref_key:"fApi",ref:D,modelValue:a(x).value,"onUpdate:modelValue":e[0]||(e[0]=oa=>a(x).value=oa),option:a(x).option,rule:a(x).rule},null,8,["modelValue","option","rule"])]),_:1})):V("",!0),((_=(c=a(o))==null?void 0:c.processDefinition)==null?void 0:_.formType)===20?(d(),X("div",P,[t(a(K),{id:a(o).businessKey},null,8,["id"])])):V("",!0)]}),_:1})),[[W,a(w)]]),t(Ka,{loading:a(E),tasks:a(v)},null,8,["loading","tasks"]),t($a,{id:`${a(A)}`,"bpmn-xml":a(j),loading:a(w),"process-instance":a(o),tasks:a(v)},null,8,["id","bpmn-xml","loading","process-instance","tasks"]),t(Na,{ref_key:"taskUpdateAssigneeFormRef",ref:N,onSuccess:g},null,512),t(Ma,{ref_key:"taskReturnDialogRef",ref:$,onSuccess:g},null,512),t(Wa,{ref_key:"taskDelegateForm",ref:Z,onSuccess:g},null,512),t(Ya,{ref_key:"taskAddSignDialogForm",ref:G,onSuccess:g},null,512)]),_:1})}}}),H=Da(R,[["__file","E:/newCode/GYZX-UI-ADMIN/src/views/bpm/processInstance/detail/index.vue"]])});export{ye as __tla,H as default};
