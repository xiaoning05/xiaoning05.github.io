import{d as R,r as p,e as q,o as C,v as F,w as n,f as e,a as t,h as y,x as B,H as D,aJ as G,l as I,am as H,G as j,C as z,I as J,a1 as X,dX as Z,aS as k,aq as $,c as A,t as E,au as K,F as Q,k as W,bZ as Y,__tla as ee}from"./index-d2088aec.js";import{_ as ae,__tla as te}from"./DictTag.vue_vue_type_script_lang-754cee6f.js";import{g as le,__tla as oe}from"./index-bbc28546.js";import{D as O,__tla as re}from"./dict-999fbee6.js";import{f as L,__tla as ne}from"./formatter-38679f6e.js";import{__tla as ie}from"./Table.vue_vue_type_style_index_0_scoped_1ee0f9ba_lang-2efd46fd.js";import{_ as ue,__tla as de}from"./Dialog.vue_vue_type_style_index_0_lang-4d2024bd.js";import{_ as pe,__tla as se}from"./index.vue_vue_type_script_setup_true_lang-6baf9e60.js";let M,ce=Promise.all([(()=>{try{return ee}catch{}})(),(()=>{try{return te}catch{}})(),(()=>{try{return oe}catch{}})(),(()=>{try{return re}catch{}})(),(()=>{try{return ne}catch{}})(),(()=>{try{return ie}catch{}})(),(()=>{try{return de}catch{}})(),(()=>{try{return se}catch{}})()]).then(async()=>{let S;S=R({name:"TableSelectForm",__name:"TableSelectForm",props:{modelValue:{default:()=>[]},title:{default:"\u9009\u62E9"}},emits:["update:modelValue"],setup(T,{expose:N,emit:w}){const b=p([]),u=p(0),s=p(!1),c=p(!1),v=p(!1),f=q({pageNo:1,pageSize:10}),V=w,a=p(),l=p([]),m=d=>{l.value=d},g=()=>{v.value=!0;try{V("update:modelValue",l.value)}finally{v.value=!1,c.value=!1}},o=async d=>{s.value=!0;try{const i=await d(f);b.value=i.list,u.value=i.total}finally{s.value=!1}};return N({open:async d=>{c.value=!0,await H(),l.value.length>0&&a.value.clearSelection(),await o(d)}}),(d,i)=>{const U=j,r=pe,h=z,x=ue,P=J;return C(),F(x,{modelValue:t(c),"onUpdate:modelValue":i[3]||(i[3]=_=>I(c)?c.value=_:null),appendToBody:!0,scroll:!0,title:d.title,width:"60%"},{footer:n(()=>[e(h,{disabled:t(v),type:"primary",onClick:g},{default:n(()=>[y("\u786E \u5B9A")]),_:1},8,["disabled"]),e(h,{onClick:i[2]||(i[2]=_=>c.value=!1)},{default:n(()=>[y("\u53D6 \u6D88")]),_:1})]),default:n(()=>[B((C(),F(t(D),{ref_key:"multipleTableRef",ref:a,data:t(b),"show-overflow-tooltip":!0,stripe:!0,onSelectionChange:m},{default:n(()=>[e(U,{type:"selection",width:"55"}),G(d.$slots,"default")]),_:3},8,["data"])),[[P,t(s)]]),e(r,{limit:t(f).pageSize,"onUpdate:limit":i[0]||(i[0]=_=>t(f).pageSize=_),page:t(f).pageNo,"onUpdate:page":i[1]||(i[1]=_=>t(f).pageNo=_),total:t(u),onPagination:o},null,8,["limit","page","total"])]),_:3},8,["modelValue","title"])}}}),M=R({name:"ProductList",__name:"ProductList",props:{modelValue:{default:()=>[]}},emits:["update:modelValue"],setup(T,{emit:N}){const w=T,b=N,u=p([]),s=p([]),c=p(),v=()=>{var a;(a=c.value)==null||a.open(le)},f=X(()=>a=>{const l=Number(a.price)/100*Number(a.count)*(1-Number(a.discountPercent)/100);return a.totalPrice=isNaN(l)?0:Z(l),isNaN(l)?0:l.toFixed(2)}),V=p(!1);return k(()=>w.modelValue,a=>{a&&a.length!==0&&!V.value&&(u.value=[...w.modelValue.map(l=>(l.totalPrice=$(l.totalPrice),l))],V.value=!0)},{immediate:!0,deep:!0}),k(u,a=>{a&&a.length!==0&&b("update:modelValue",u.value)},{deep:!0}),k(s,a=>{if(!a||a.length===0)return;const l=u.value.map(g=>g.id),m=s.value.filter(g=>l.indexOf(g.id)===-1);m&&m.length!==0&&u.value.push(...m)},{deep:!0}),(a,l)=>{const m=z,g=W,o=j,d=ae,i=Y,U=D;return C(),A(Q,null,[e(g,{justify:"end"},{default:n(()=>[e(m,{plain:"",type:"primary",onClick:v},{default:n(()=>[y("\u6DFB\u52A0\u4EA7\u54C1")]),_:1})]),_:1}),e(U,{data:t(u),"show-overflow-tooltip":!0,stripe:!0},{default:n(()=>[e(o,{align:"center",label:"\u4EA7\u54C1\u540D\u79F0",prop:"name",width:"120"}),e(o,{formatter:t(L),align:"center",label:"\u4EF7\u683C",prop:"price",width:"100"},null,8,["formatter"]),e(o,{align:"center",label:"\u4EA7\u54C1\u7C7B\u578B",prop:"categoryName",width:"100"}),e(o,{align:"center",label:"\u4EA7\u54C1\u5355\u4F4D",prop:"unit"},{default:n(r=>[e(d,{type:t(O).CRM_PRODUCT_UNIT,value:r.row.unit},null,8,["type","value"])]),_:1}),e(o,{align:"center",label:"\u4EA7\u54C1\u7F16\u7801",prop:"no"}),e(o,{align:"center",fixed:"right",label:"\u6570\u91CF",prop:"count",width:"100"},{default:n(({row:r})=>[e(i,{modelValue:r.count,"onUpdate:modelValue":h=>r.count=h,"controls-position":"right",min:0,precision:0,class:"!w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(o,{align:"center",fixed:"right",label:"\u6298\u6263(%)",prop:"discountPercent",width:"120"},{default:n(({row:r})=>[e(i,{modelValue:r.discountPercent,"onUpdate:modelValue":h=>r.discountPercent=h,"controls-position":"right",min:0,max:100,precision:0,class:"!w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(o,{align:"center",fixed:"right",label:"\u5408\u8BA1",prop:"totalPrice",width:"100"},{default:n(({row:r})=>[y(E(t(K)(t(f)(r))),1)]),_:1}),e(o,{align:"center",fixed:"right",label:"\u64CD\u4F5C",width:"60"},{default:n(r=>[e(m,{link:"",type:"danger",onClick:h=>(x=>{const P=u.value.findIndex(_=>_.id===x);P!==-1&&u.value.splice(P,1)})(r.row.id)},{default:n(()=>[y(" \u79FB\u9664")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e(t(S),{ref_key:"tableSelectFormRef",ref:c,modelValue:t(s),"onUpdate:modelValue":l[0]||(l[0]=r=>I(s)?s.value=r:null),title:"\u9009\u62E9\u4EA7\u54C1"},{default:n(()=>[e(o,{align:"center",label:"\u4EA7\u54C1\u540D\u79F0",prop:"name",width:"160"}),e(o,{align:"center",label:"\u4EA7\u54C1\u7C7B\u578B",prop:"categoryName",width:"160"}),e(o,{align:"center",label:"\u4EA7\u54C1\u5355\u4F4D",prop:"unit"},{default:n(r=>[e(d,{type:t(O).CRM_PRODUCT_UNIT,value:r.row.unit},null,8,["type","value"])]),_:1}),e(o,{align:"center",label:"\u4EA7\u54C1\u7F16\u7801",prop:"no"}),e(o,{formatter:t(L),align:"center",label:"\u4EF7\u683C\uFF08\u5143\uFF09",prop:"price",width:"100"},null,8,["formatter"])]),_:1},8,["modelValue"])],64)}}})});export{M as _,ce as __tla};
