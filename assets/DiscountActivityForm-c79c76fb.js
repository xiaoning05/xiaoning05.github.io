import{e as U,aq as v,d as B,i as K,r as c,o as A,c as Q,f as i,w as u,a as r,h as k,x as W,v as $,l as tt,F as at,at as et,an as ot,D as st,c0 as rt,H as lt,J as it,_ as ct,__tla as ut}from"./index-f0743f71.js";import{_ as nt,__tla as dt}from"./Dialog-8f786edd.js";import{_ as pt,__tla as mt}from"./Form-3e953638.js";import _t,{__tla as ft}from"./SpuSelect-7fa36f5f.js";import yt,{__tla as vt}from"./SpuAndSkuList-41be7fa0.js";import{b as E,__tla as ht}from"./formatTime-e6df2ea5.js";import{r as h,__tla as wt}from"./formRules-5c05c0bb.js";import{D as gt,__tla as bt}from"./dict-4a9940b3.js";import{u as Pt,__tla as kt}from"./useCrudSchemas-7a260292.js";import{b as St,__tla as Dt}from"./spu-5cbf535f.js";import{g as Ct,__tla as It}from"./index-6c38c988.js";import{u as Tt,__tla as Vt}from"./useMessage-75a00a06.js";let S,O,x,j,N,Ft=Promise.all([(()=>{try{return ut}catch{}})(),(()=>{try{return dt}catch{}})(),(()=>{try{return mt}catch{}})(),(()=>{try{return ft}catch{}})(),(()=>{try{return vt}catch{}})(),(()=>{try{return ht}catch{}})(),(()=>{try{return wt}catch{}})(),(()=>{try{return bt}catch{}})(),(()=>{try{return kt}catch{}})(),(()=>{try{return Dt}catch{}})(),(()=>{try{return It}catch{}})(),(()=>{try{return Vt}catch{}})()]).then(async()=>{let D,C,I;D=U({spuId:[h],name:[h],startTime:[h],endTime:[h],discountType:[h]}),C=U([{label:"\u6D3B\u52A8\u540D\u79F0",field:"name",isSearch:!0,form:{colProps:{span:24}},table:{width:120}},{label:"\u6D3B\u52A8\u5F00\u59CB\u65F6\u95F4",field:"startTime",formatter:E,isSearch:!0,search:{component:"DatePicker",componentProps:{valueFormat:"YYYY-MM-DD",type:"daterange"}},form:{component:"DatePicker",componentProps:{type:"date",valueFormat:"x"}},table:{width:120}},{label:"\u6D3B\u52A8\u7ED3\u675F\u65F6\u95F4",field:"endTime",formatter:E,isSearch:!0,search:{component:"DatePicker",componentProps:{valueFormat:"YYYY-MM-DD",type:"daterange"}},form:{component:"DatePicker",componentProps:{type:"date",valueFormat:"x"}},table:{width:120}},{label:"\u4F18\u60E0\u7C7B\u578B",field:"discountType",dictType:gt.PROMOTION_DISCOUNT_TYPE,dictClass:"number",isSearch:!0,form:{component:"Radio",value:1}},{label:"\u6D3B\u52A8\u5546\u54C1",field:"spuId",isTable:!0,isSearch:!1,form:{colProps:{span:24}},table:{width:300}},{label:"\u5907\u6CE8",field:"remark",isSearch:!1,form:{component:"Input",componentProps:{type:"textarea",rows:4},colProps:{span:24}},table:{width:300}}]),{allSchemas:I}=Pt(C),N=async m=>await v.get({url:"/promotion/discount-activity/page",params:m}),x=async m=>await v.put({url:"/promotion/discount-activity/close?id="+m}),j=async m=>await v.delete({url:"/promotion/discount-activity/delete?id="+m}),S=ct(B({name:"PromotionDiscountActivityForm",__name:"DiscountActivityForm",emits:["success"],setup(m,{expose:H,emit:L}){const{t:b}=K(),T=Tt(),_=c(!1),V=c(""),f=c(!1),F=c(""),n=c(),Y=c(),M=c(),q=[],w=c([]),P=c([]),z=(s,a)=>{n.value.setValues({spuId:s}),R(s,a)},R=async(s,a,e)=>{var g;const l=[],d=await St([s]);if(d.length==0)return;w.value=[];const t=d[0],y=a===void 0?t==null?void 0:t.skus:(g=t==null?void 0:t.skus)==null?void 0:g.filter(o=>a.includes(o.id));y==null||y.forEach(o=>{let p={skuId:o.id,spuId:t.id,discountType:1,discountPercent:0,discountPrice:0};e!==void 0&&(p=e.find(Z=>Z.skuId===o.id)||p),o.productConfig=p}),t.skus=y,l.push({spuId:t.id,spuDetail:t,propertyList:Ct(t)}),w.value.push(t),P.value=l};H({open:async(s,a)=>{var e;if(_.value=!0,V.value=b("action."+s),F.value=s,await X(),a){f.value=!0;try{const l=await(async t=>await v.get({url:"/promotion/discount-activity/get?id="+t}))(a),d=l.products[0].spuId;await R(d,(e=l.products)==null?void 0:e.map(t=>t.skuId),l.products),n.value.setValues(l)}finally{f.value=!1}}}});const G=L,J=async()=>{if(n&&await n.value.getElFormRef().validate()){f.value=!0;try{const s=n.value.formModel,a=et(M.value.getSkuConfigs("productConfig"));a.forEach(e=>{e.discountType=s.discountType}),s.products=a,F.value==="create"?(await(async e=>await v.post({url:"/promotion/discount-activity/create",data:e}))(s),T.success(b("common.createSuccess"))):(await(async e=>await v.put({url:"/promotion/discount-activity/update",data:e}))(s),T.success(b("common.updateSuccess"))),_.value=!1,G("success")}finally{f.value=!1}}},X=async()=>{w.value=[],P.value=[],await ot(),n.value.getElFormRef().resetFields()};return(s,a)=>{const e=st,l=rt,d=lt,t=pt,y=nt,g=it;return A(),Q(at,null,[i(y,{modelValue:r(_),"onUpdate:modelValue":a[2]||(a[2]=o=>tt(_)?_.value=o:null),title:r(V),width:"65%"},{footer:u(()=>[i(e,{disabled:r(f),type:"primary",onClick:J},{default:u(()=>[k("\u786E \u5B9A")]),_:1},8,["disabled"]),i(e,{onClick:a[1]||(a[1]=o=>_.value=!1)},{default:u(()=>[k("\u53D6 \u6D88")]),_:1})]),default:u(()=>[W((A(),$(t,{ref_key:"formRef",ref:n,isCol:!0,rules:r(D),schema:r(I).formSchema},{spuId:u(()=>[i(e,{onClick:a[0]||(a[0]=o=>r(Y).open())},{default:u(()=>[k("\u9009\u62E9\u5546\u54C1")]),_:1}),i(r(yt),{ref_key:"spuAndSkuListRef",ref:M,"rule-config":q,"spu-list":r(w),"spu-property-list-p":r(P)},{default:u(()=>[i(d,{align:"center",label:"\u4F18\u60E0\u91D1\u989D","min-width":"168"},{default:u(({row:o})=>[i(l,{modelValue:o.productConfig.discountPrice,"onUpdate:modelValue":p=>o.productConfig.discountPrice=p,min:0,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(d,{align:"center",label:"\u6298\u6263\u767E\u5206\u6BD4(%)","min-width":"168"},{default:u(({row:o})=>[i(l,{modelValue:o.productConfig.discountPercent,"onUpdate:modelValue":p=>o.productConfig.discountPercent=p,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["spu-list","spu-property-list-p"])]),_:1},8,["rules","schema"])),[[g,r(f)]])]),_:1},8,["modelValue","title"]),i(r(_t),{ref_key:"spuSelectRef",ref:Y,isSelectSku:!0,onConfirm:z},null,512)],64)}}}),[["__file","E:/newCode/GYZX-UI-ADMIN/src/views/mall/promotion/discountActivity/DiscountActivityForm.vue"]]),O=Object.freeze(Object.defineProperty({__proto__:null,default:S},Symbol.toStringTag,{value:"Module"}))});export{S as D,Ft as __tla,O as a,x as c,j as d,N as g};
