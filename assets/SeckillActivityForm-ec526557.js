import{n as U,d as G,k as Z,r as c,o as x,c as H,b as _,e as i,a as o,h as g,w as J,q as K,j as O,F as W,aq as $,ar as z,as as Q,al as tt,B as at,bX as et,E as rt,v as lt,_ as ot,__tla as st}from"./index-b079f499.js";import{_ as _t,__tla as ct}from"./Dialog-07bcd661.js";import{_ as it,__tla as mt}from"./Form-ee45a7be.js";import nt,{__tla as ut}from"./SpuSelect-e2345fa6.js";import pt,{__tla as ft}from"./SpuAndSkuList-91e834aa.js";import{b as A,__tla as dt}from"./formatTime-0805635f.js";import{g as ht,__tla as yt}from"./seckillConfig-221e1409.js";import{r as m,__tla as vt}from"./formRules-ddc6648c.js";import{u as kt,__tla as bt}from"./useCrudSchemas-0ded0703.js";import{g as wt,c as gt,u as Pt,__tla as Ct}from"./seckillActivity-cc300b0d.js";import{b as St,__tla as It}from"./spu-b2e776cb.js";import{g as Ft,__tla as Vt}from"./index-b89d4365.js";import{u as Dt,__tla as Yt}from"./useMessage-66b9cf03.js";import{__tla as Et}from"./Form.vue_vue_type_style_index_0_scoped_b283cb39_lang-128eda63.js";import{__tla as Ut}from"./el-virtual-list-82e25059.js";import{__tla as xt}from"./el-tree-select-6f7a72c0.js";import{__tla as At}from"./el-time-select-8cc845e9.js";import{__tla as Lt}from"./InputPassword-4d2cd0ef.js";import{__tla as Mt}from"./Editor-519724cd.js";import{__tla as Nt}from"./UploadImg-0fb33d7e.js";import{__tla as Rt}from"./index-1bcef585.js";import{__tla as Tt}from"./el-image-viewer-3e8b0085.js";import{__tla as jt}from"./useUpload-ca092158.js";import{__tla as qt}from"./index-4c44a910.js";import{__tla as Xt}from"./UploadImgs-2af287de.js";import{__tla as Bt}from"./UploadImgs.vue_vue_type_style_index_0_scoped_9d666400_lang-62ab8f5e.js";import{__tla as Gt}from"./UploadFile-8c3c7f37.js";import{__tla as Zt}from"./UploadFile.vue_vue_type_style_index_0_scoped_436eca1b_lang-ccf69cde.js";import{__tla as Ht}from"./tsxHelper-b83ae8eb.js";import{__tla as Jt}from"./ContentWrap-0fab5b86.js";import{__tla as Kt}from"./index-3be78f60.js";import{__tla as Ot}from"./index-749396de.js";import{__tla as Wt}from"./index-c1a7e444.js";import{__tla as $t}from"./el-image-8a70494f.js";import"./tree-02f455f9.js";import{__tla as zt}from"./category-ffa87404.js";import{__tla as Qt}from"./SkuList-e3781fdf.js";import{__tla as ta}from"./dict-2c56908b.js";import{__tla as aa}from"./DictTag-6d4c3489.js";import"./color-f5b6e279.js";let L,ea=Promise.all([(()=>{try{return st}catch{}})(),(()=>{try{return ct}catch{}})(),(()=>{try{return mt}catch{}})(),(()=>{try{return ut}catch{}})(),(()=>{try{return ft}catch{}})(),(()=>{try{return dt}catch{}})(),(()=>{try{return yt}catch{}})(),(()=>{try{return vt}catch{}})(),(()=>{try{return bt}catch{}})(),(()=>{try{return Ct}catch{}})(),(()=>{try{return It}catch{}})(),(()=>{try{return Vt}catch{}})(),(()=>{try{return Yt}catch{}})(),(()=>{try{return Et}catch{}})(),(()=>{try{return Ut}catch{}})(),(()=>{try{return xt}catch{}})(),(()=>{try{return At}catch{}})(),(()=>{try{return Lt}catch{}})(),(()=>{try{return Mt}catch{}})(),(()=>{try{return Nt}catch{}})(),(()=>{try{return Rt}catch{}})(),(()=>{try{return Tt}catch{}})(),(()=>{try{return jt}catch{}})(),(()=>{try{return qt}catch{}})(),(()=>{try{return Xt}catch{}})(),(()=>{try{return Bt}catch{}})(),(()=>{try{return Gt}catch{}})(),(()=>{try{return Zt}catch{}})(),(()=>{try{return Ht}catch{}})(),(()=>{try{return Jt}catch{}})(),(()=>{try{return Kt}catch{}})(),(()=>{try{return Ot}catch{}})(),(()=>{try{return Wt}catch{}})(),(()=>{try{return $t}catch{}})(),(()=>{try{return zt}catch{}})(),(()=>{try{return Qt}catch{}})(),(()=>{try{return ta}catch{}})(),(()=>{try{return aa}catch{}})()]).then(async()=>{let P,C,S;P=U({spuId:[m],name:[m],startTime:[m],endTime:[m],sort:[m],configIds:[m],totalLimitCount:[m],singleLimitCount:[m],totalStock:[m]}),C=U([{label:"\u79D2\u6740\u6D3B\u52A8\u540D\u79F0",field:"name",isSearch:!0,form:{colProps:{span:24}},table:{width:120}},{label:"\u6D3B\u52A8\u5F00\u59CB\u65F6\u95F4",field:"startTime",formatter:A,isSearch:!0,search:{component:"DatePicker",componentProps:{valueFormat:"YYYY-MM-DD",type:"daterange"}},form:{component:"DatePicker",componentProps:{type:"date",valueFormat:"x"}},table:{width:120}},{label:"\u6D3B\u52A8\u7ED3\u675F\u65F6\u95F4",field:"endTime",formatter:A,isSearch:!0,search:{component:"DatePicker",componentProps:{valueFormat:"YYYY-MM-DD",type:"daterange"}},form:{component:"DatePicker",componentProps:{type:"date",valueFormat:"x"}},table:{width:120}},{label:"\u79D2\u6740\u65F6\u6BB5",field:"configIds",form:{component:"Select",componentProps:{multiple:!0,optionsAlias:{labelField:"name",valueField:"id"}},api:ht},table:{width:300}},{label:"\u603B\u9650\u8D2D\u6570\u91CF",field:"totalLimitCount",form:{component:"InputNumber",value:0},table:{width:120}},{label:"\u5355\u6B21\u9650\u591F\u6570\u91CF",field:"singleLimitCount",form:{component:"InputNumber",value:0},table:{width:120}},{label:"\u6392\u5E8F",field:"sort",form:{component:"InputNumber",value:0},table:{width:80}},{label:"\u79D2\u6740\u6D3B\u52A8\u5546\u54C1",field:"spuId",isTable:!0,isSearch:!1,form:{colProps:{span:24}},table:{width:300}},{label:"\u5907\u6CE8",field:"remark",isSearch:!1,form:{component:"Input",componentProps:{type:"textarea",rows:4},colProps:{span:24}},table:{width:300}}]),{allSchemas:S}=kt(C),L=ot(G({name:"PromotionSeckillActivityForm",__name:"SeckillActivityForm",emits:["success"],setup(ra,{expose:M,emit:N}){const{t:b}=Z(),I=Dt(),f=c(!1),F=c(""),d=c(!1),V=c(""),n=c(),D=c(),Y=c(),R=[{name:"productConfig.stock",rule:a=>a>=1,message:"\u5546\u54C1\u79D2\u6740\u5E93\u5B58\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E 1 \uFF01\uFF01\uFF01"},{name:"productConfig.seckillPrice",rule:a=>a>=.01,message:"\u5546\u54C1\u79D2\u6740\u4EF7\u683C\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E 0.01 \uFF01\uFF01\uFF01"}],y=c([]),w=c([]),T=(a,t)=>{n.value.setValues({spuId:a}),E(a,t)},E=async(a,t,l)=>{var v;const s=[],u=await St([a]);if(u.length==0)return;y.value=[];const r=u[0],h=t===void 0?r==null?void 0:r.skus:(v=r==null?void 0:r.skus)==null?void 0:v.filter(e=>t.includes(e.id));h==null||h.forEach(e=>{let p={skuId:e.id,stock:0,seckillPrice:0};if(l!==void 0){const k=l.find(B=>B.skuId===e.id);k&&(k.seckillPrice=$(k.seckillPrice)),p=k||p}e.productConfig=p}),r.skus=h,s.push({spuId:r.id,spuDetail:r,propertyList:Ft(r)}),y.value.push(r),w.value=s};M({open:async(a,t)=>{var l;if(f.value=!0,F.value=b("action."+a),V.value=a,await X(),t){d.value=!0;try{const s=await wt(t);await E(s.spuId,(l=s.products)==null?void 0:l.map(u=>u.skuId),s.products),n.value.setValues(s)}finally{d.value=!1}}}});const j=N,q=async()=>{if(n&&await n.value.getElFormRef().validate()){d.value=!0;try{const a=z(Y.value.getSkuConfigs("productConfig"));a.forEach(l=>{l.seckillPrice=Q(l.seckillPrice)});const t=n.value.formModel;t.products=a,V.value==="create"?(await gt(t),I.success(b("common.createSuccess"))):(await Pt(t),I.success(b("common.updateSuccess"))),f.value=!1,j("success")}finally{d.value=!1}}},X=async()=>{y.value=[],w.value=[],await tt(),n.value.getElFormRef().resetFields()};return(a,t)=>{const l=at,s=et,u=rt,r=it,h=_t,v=lt;return x(),H(W,null,[_(h,{modelValue:o(f),"onUpdate:modelValue":t[2]||(t[2]=e=>O(f)?f.value=e:null),title:o(F),width:"65%"},{footer:i(()=>[_(l,{disabled:o(d),type:"primary",onClick:q},{default:i(()=>[g("\u786E \u5B9A")]),_:1},8,["disabled"]),_(l,{onClick:t[1]||(t[1]=e=>f.value=!1)},{default:i(()=>[g("\u53D6 \u6D88")]),_:1})]),default:i(()=>[J((x(),K(r,{ref_key:"formRef",ref:n,isCol:!0,rules:o(P),schema:o(S).formSchema},{spuId:i(()=>[_(l,{onClick:t[0]||(t[0]=e=>o(D).open())},{default:i(()=>[g("\u9009\u62E9\u5546\u54C1")]),_:1}),_(o(pt),{ref_key:"spuAndSkuListRef",ref:Y,"rule-config":R,"spu-list":o(y),"spu-property-list-p":o(w)},{default:i(()=>[_(u,{align:"center",label:"\u79D2\u6740\u5E93\u5B58","min-width":"168"},{default:i(({row:e})=>[_(s,{modelValue:e.productConfig.stock,"onUpdate:modelValue":p=>e.productConfig.stock=p,min:0,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),_(u,{align:"center",label:"\u79D2\u6740\u4EF7\u683C(\u5143)","min-width":"168"},{default:i(({row:e})=>[_(s,{modelValue:e.productConfig.seckillPrice,"onUpdate:modelValue":p=>e.productConfig.seckillPrice=p,min:0,precision:2,step:.1,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["spu-list","spu-property-list-p"])]),_:1},8,["rules","schema"])),[[v,o(d)]])]),_:1},8,["modelValue","title"]),_(o(nt),{ref_key:"spuSelectRef",ref:D,isSelectSku:!0,onConfirm:T},null,512)],64)}}}),[["__file","E:/newCode/GYZX-UI-ADMIN/src/views/mall/promotion/seckill/activity/SeckillActivityForm.vue"]])});export{ea as __tla,L as default};
